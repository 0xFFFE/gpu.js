/**
 * gpu.js
 * http://gpu.rocks/
 *
 * GPU Accelerated JavaScript
 *
 * @version 2.0.0
 * @date Sat Jan 26 2019 21:46:22 GMT-0500 (Eastern Standard Time)
 *
 * @license MIT
 * The MIT License
 *
 * Copyright (c) 2019 gpu.js Team
 */
"use strict";!function(){function t(e,n,i){function r(a,o){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return r(n||t)},c,c.exports,t,e,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}return t}()({1:[function(t,e,n){function i(t,e){var n=e.toString();return new Function("return function "+t+" ("+r.getArgumentNamesFromString(n).join(", ")+") {"+r.getFunctionBodyFromString(n)+"}")()}var r=t("./utils");e.exports=i},{"./utils":24}],2:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("../function-node"),u=(t("../../utils"),function(t){function e(t,n){i(this,e),n=n||{};var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return s.memberStates=[],s._string=null,s}return s(e,t),a(e,[{key:"pushMemberState",value:function(t){this.memberStates.push(t)}},{key:"popMemberState",value:function(t){if(this.memberState!==t)throw new Error("Cannot popMemberState "+t+" when in "+this.memberState);this.memberStates.pop()}},{key:"toString",value:function(){return this._string?this._string:this._string=this.astGeneric(this.getJsAST(),[]).join("").trim()}},{key:"astFunctionPrototype",value:function(t,e){if(this.isRootKernel||this.isSubKernel)return e;e.push(this.returnType),e.push(" "),e.push(this.name),e.push("(");for(var n=0;n<this.argumentNames.length;++n)n>0&&e.push(", "),e.push("user_"),e.push(this.argumentNames[n]);return e.push(");\n"),e}},{key:"astFunctionExpression",value:function(t,e){if(!this.isRootKernel){e.push("function"),e.push(" "),e.push(this.name),e.push("(");for(var n=0;n<this.argumentNames.length;++n){var i=this.argumentNames[n];n>0&&e.push(", "),e.push("user_"),e.push(i)}e.push(") {\n")}for(var r=0;r<t.body.body.length;++r)this.astGeneric(t.body.body[r],e),e.push("\n");return this.isRootKernel||e.push("}\n"),e}},{key:"astReturnStatement",value:function(t,e){return this.isRootKernel?(e.push("kernelResult = "),this.astGeneric(t.argument,e),e.push(";")):this.isSubKernel?(e.push("subKernelResult_"+this.name+" = "),this.astGeneric(t.argument,e),e.push(";"),e.push("return subKernelResult_"+this.name+";")):(e.push("return "),this.astGeneric(t.argument,e),e.push(";")),e}},{key:"astLiteral",value:function(t,e){if(isNaN(t.value))throw this.astErrorOutput("Non-numeric literal not supported : "+t.value,t);return e.push(t.value),e}},{key:"astBinaryExpression",value:function(t,e){return e.push("("),this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e.push(")"),e}},{key:"astIdentifierExpression",value:function(t,e){if("Identifier"!==t.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",t);switch(this.state){case"input-index-y":case"input-index-z":e.push("(")}switch(t.name){case"gpu_threadX":e.push("_this.thread.x");break;case"gpu_threadY":e.push("_this.thread.y");break;case"gpu_threadZ":e.push("_this.thread.z");break;case"gpu_outputX":e.push("_this.output.x");break;case"gpu_outputY":e.push("_this.output.y");break;case"gpu_outputZ":e.push("_this.output.z");break;case"Infinity":e.push("Infinity");break;default:if(this.constants&&this.constants.hasOwnProperty(t.name))e.push("constants_"+t.name);else{var n=this.getUserArgumentName(t.name);null!==n?e.push("user_"+n):e.push("user_"+t.name)}}switch(this.state){case"input-index-y":var i=this.argumentSizes[this.argumentNames.indexOf(this.memberState)];e.push(" * "+i[0]+")");break;case"input-index-z":var r=this.argumentSizes[this.argumentNames.indexOf(this.memberState)];e.push(" * "+r[0]*r[1]+")")}return e}},{key:"astForStatement",value:function(t,e){if("ForStatement"!==t.type)throw this.astErrorOutput("Invalid for statement",t);if(t.test&&"BinaryExpression"===t.test.type){if("Identifier"===t.test.right.type&&"<"===t.test.operator&&this.isIdentifierConstant(t.test.right.name)===!1){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),e.push("for ("),this.astGeneric(t.init,e),";"!==e[e.length-1]&&e.push(";"),this.astGeneric(t.test.left,e),e.push(t.test.operator),e.push("LOOP_MAX"),e.push(";"),this.astGeneric(t.update,e),e.push(")"),e.push("{\n"),e.push("if ("),this.astGeneric(t.test.left,e),e.push(t.test.operator),this.astGeneric(t.test.right,e),e.push(") {\n"),"BlockStatement"===t.body.type)for(var n=0;n<t.body.body.length;n++)this.astGeneric(t.body.body[n],e);else this.astGeneric(t.body,e);return e.push("} else {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}if(t.init.declarations){var i=t.init.declarations;if(!Array.isArray(i)||i.length<1)throw new Error("Error: Incompatible for loop declaration");if(i.length>1){e.push("for ("),e.push(t.init.kind+" ");for(var r=0;r<i.length;r++)r>0&&e.push(","),this.astGeneric(i[r],e);e.push(";")}else e.push("for ("),this.astGeneric(t.init,e);return this.astGeneric(t.test,e),e.push(";"),this.astGeneric(t.update,e),e.push(")"),this.astGeneric(t.body,e),e}}throw this.astErrorOutput("Invalid for statement",t)}},{key:"astWhileStatement",value:function(t,e){if("WhileStatement"!==t.type)throw this.astErrorOutput("Invalid while statement",t);return e.push("for (let i = 0; i < LOOP_MAX; i++) {"),e.push("if ("),this.astGeneric(t.test,e),e.push(") {\n"),this.astGeneric(t.body,e),e.push("} else {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}},{key:"astDoWhileStatement",value:function(t,e){if("DoWhileStatement"!==t.type)throw this.astErrorOutput("Invalid while statement",t);return e.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(t.body,e),e.push("if (!"),this.astGeneric(t.test,e),e.push(") {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}},{key:"astAssignmentExpression",value:function(t,e){return this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e}},{key:"astEmptyStatement",value:function(t,e){return e}},{key:"astBlockStatement",value:function(t,e){e.push("{\n");for(var n=0;n<t.body.length;n++)this.astGeneric(t.body[n],e);return e.push("}\n"),e}},{key:"astExpressionStatement",value:function(t,e){return this.astGeneric(t.expression,e),e.push(";"),e}},{key:"astVariableDeclaration",value:function(t,e){"var"===t.kind&&this.varWarn(),e.push(t.kind+" ");for(var n=0;n<t.declarations.length;n++)this.declarations[t.declarations[n].id.name]=t.kind,n>0&&e.push(","),this.astGeneric(t.declarations[n],e);return e.push(";"),e}},{key:"astVariableDeclarator",value:function(t,e){return this.astGeneric(t.id,e),null!==t.init&&(e.push("="),this.astGeneric(t.init,e)),e}},{key:"astIfStatement",value:function(t,e){return e.push("if ("),this.astGeneric(t.test,e),e.push(")"),"BlockStatement"===t.consequent.type?this.astGeneric(t.consequent,e):(e.push(" {\n"),this.astGeneric(t.consequent,e),e.push("\n}\n")),t.alternate&&(e.push("else "),"BlockStatement"===t.alternate.type?this.astGeneric(t.alternate,e):(e.push(" {\n"),this.astGeneric(t.alternate,e),e.push("\n}\n"))),e}},{key:"astBreakStatement",value:function(t,e){return e.push("break;\n"),e}},{key:"astContinueStatement",value:function(t,e){return e.push("continue;\n"),e}},{key:"astLogicalExpression",value:function(t,e){return e.push("("),this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e.push(")"),e}},{key:"astUpdateExpression",value:function(t,e){return t.prefix?(e.push(t.operator),this.astGeneric(t.argument,e)):(this.astGeneric(t.argument,e),e.push(t.operator)),e}},{key:"astUnaryExpression",value:function(t,e){return t.prefix?(e.push(t.operator),this.astGeneric(t.argument,e)):(this.astGeneric(t.argument,e),e.push(t.operator)),e}},{key:"astThisExpression",value:function(t,e){return e.push("_this"),e}},{key:"astMemberExpression",value:function(t,e){if(t.computed)if("Identifier"===t.object.type||"MemberExpression"===t.object.type&&t.object.object.object&&"ThisExpression"===t.object.object.object.type&&"constants"===t.object.object.property.name)this.pushState("identifier"),this.astGeneric(t.object,e),this.popState("identifier"),e.push("["),this.isInput(t.object.name)?this.astGeneric(t.property,e):this.astGeneric(t.property,e),e.push("]");else if(t.object.object)if(t.object.object.object&&this.isInput(t.object.object.object.name)){this.pushMemberState(t.object.object.object.name),this.pushState("input-index-z"),this.astGeneric(t.object,e);var n=e.pop();e.push(" + "),this.popState("input-index-z"),this.pushState("input-index"),this.astGeneric(t.property,e),this.popState("input-index"),e.push(n),this.popMemberState(t.object.object.object.name)}else if(this.isInput(t.object.object.name)){this.pushMemberState(t.object.object.name),this.isState("input-index-z")||this.pushState("input-index-y"),this.astGeneric(t.object,e);var i=e.pop();e.push(" + "),this.isState("input-index-z")||this.popState("input-index-y");var r=this.isState("input-index-z");r?this.pushState("input-index-y"):this.pushState("input-index"),this.astGeneric(t.property,e),r?this.popState("input-index-y"):this.popState("input-index"),e.push(i),this.popMemberState(t.object.object.name)}else{this.astGeneric(t.object,e);var s=e.pop();e.push("]["),this.astGeneric(t.property,e),e.push(s)}else{this.astGeneric(t.object,e);var a=e.pop();e.push("]["),this.astGeneric(t.property,e),e.push(a)}else{var o=this.astMemberExpressionUnroll(t);switch("Identifier"===t.property.type&&t.computed&&(o="user_"+o),0===o.indexOf("this.constants")?o="constants_"+o.substring(15):0===o.indexOf("this")&&(o="_"+o),this.state){case"input-index-y":case"input-index-z":e.push("(")}switch(o){case"_this.output.x":e.push(this.output[0]);break;case"_this.output.y":e.push(this.output[1]);break;case"_this.output.z":e.push(this.output[2]);break;default:t.object&&t.object.name&&this.declarations[t.object.name]&&e.push("user_"),e.push(o)}switch(this.state){case"input-index-y":var u=this.argumentSizes[this.argumentNames.indexOf(this.memberState)];e.push(" * "+u[0]+")");break;case"input-index-z":var h=this.argumentSizes[this.argumentNames.indexOf(this.memberState)];e.push(" * "+h[0]*h[1]+")")}}return e}},{key:"astSequenceExpression",value:function(t,e){for(var n=0;n<t.expressions.length;n++)n>0&&e.push(","),this.astGeneric(t.expressions,e);return e}},{key:"astCallExpression",value:function(t,e){if(t.callee){var n=this.astMemberExpressionUnroll(t.callee);this.calledFunctions.indexOf(n)<0&&this.calledFunctions.push(n),this.hasOwnProperty("funcName")||(this.calledFunctionsArguments[n]=[]);var i=[];this.calledFunctionsArguments[n].push(i),e.push(n),e.push("(");for(var r=0;r<t.arguments.length;++r){var s=t.arguments[r];if(r>0&&e.push(", "),this.astGeneric(s,e),"Identifier"===s.type){var a=this.argumentNames.indexOf(s.name);a===-1?i.push(null):i.push({name:s.name,type:this.argumentTypes[a]})}else i.push(null)}return e.push(")"),e}throw this.astErrorOutput("Unknown CallExpression",t)}},{key:"astArrayExpression",value:function(t,e){var n=t.elements.length;e.push("[");for(var i=0;i<n;++i){i>0&&e.push(", ");var r=t.elements[i];this.astGeneric(r,e)}return e.push("]"),e}},{key:"astDebuggerStatement",value:function(t,e){return e.push("debugger;"),e}},{key:"varWarn",value:function(){console.warn("var declarations are not supported, weird things happen.  Use const or let")}},{key:"memberState",get:function(){return this.memberStates[this.memberStates.length-1]}}]),e}(o));e.exports=u},{"../../utils":24,"../function-node":6}],3:[function(t,e,n){function i(t){return/^function /.test(t)&&(t=t.substring(9)),t.replace(/[_]typeof/g,"typeof")}function r(t){return t.replace(/^[A-Za-z]+/,"function").replace(/[_]typeof/g,"typeof")}var s=t("../../utils"),a=t("../../kernel-run-shortcut");e.exports=function(t,e){return"() => {\n    "+a.toString()+";\n    const utils = {\n      allPropertiesOf: "+r(s.allPropertiesOf.toString())+",\n      clone: "+r(s.clone.toString())+",\n    };\n    const Utils = utils;\n    let Input = function() {};\n    class "+(e||"Kernel")+" {\n      constructor() {        \n        this.argumentsLength = 0;\n        this.canvas = null;\n        this.context = null;\n        this.built = false;\n        this.program = null;\n        this.argumentNames = "+JSON.stringify(t.argumentNames)+";\n        this.argumentTypes = "+JSON.stringify(t.argumentTypes)+";\n        this.texSize = "+JSON.stringify(t.texSize)+";\n        this.output = "+JSON.stringify(t.output)+";\n        this._kernelString = `"+t._kernelString+"`;\n        this.output = "+JSON.stringify(t.output)+";\n\t\t    this.run = function() {\n          this.run = null;\n          this.build();\n          return this.run.apply(this, arguments);\n        }.bind(this);\n        this.thread = {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n      }\n      setCanvas(canvas) { this.canvas = canvas; return this; }\n      setContext(context) { this.context = context; return this; }\n      setInput(Type) { Input = Type; }\n      "+i(t.build.toString())+"\n      "+i(t.setupArguments.toString())+"\n      "+i(t.setupConstants.toString())+"\n      run () { "+t.kernelString+" }\n      getKernelString() { return this._kernelString; }\n      "+i(t.validateSettings.toString())+"\n      "+i(t.checkOutput.toString())+"\n    };\n    return kernelRunShortcut(new Kernel());\n  };"}},{"../../kernel-run-shortcut":22,"../../utils":24}],4:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("../kernel"),u=t("../function-builder"),h=t("./function-node"),c=t("../../utils"),l=t("./kernel-string"),p=function(t){function e(t,n){i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return s._imageData=null,s._colorData=null,s._kernelString=null,s.thread={x:0,y:0,z:0},s.run=function(){return this.run=null,this.build.apply(this,arguments),this.run.apply(this,arguments)}.bind(s),s}return s(e,t),a(e,null,[{key:"getFeatures",value:function(){return this.features}},{key:"isContextMatch",value:function(t){return!1}},{key:"getMode",value:function(){return"cpu"}},{key:"features",get:function(){return Object.freeze({kernelMap:!0,isIntegerDivisionAccurate:!0})}},{key:"isSupported",get:function(){return!0}}]),a(e,[{key:"initCanvas",value:function(){return"undefined"!=typeof document?document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(0,0):void 0}},{key:"initContext",value:function(){return this.canvas?this.canvas.getContext("2d"):null}},{key:"validateSettings",value:function(){if(!this.output||0===this.output.length){if(1!==arguments.length)throw"Auto dimensions only supported for kernels with only one input";var t=c.getVariableType(arguments[0]);if("Array"===t)this.output=c.getDimensions(t);else{if("NumberTexture"!==t&&"ArrayTexture(4)"!==t)throw"Auto dimensions not supported for input type: "+t;this.output=arguments[0].output}}this.checkOutput()}},{key:"build",value:function(){this.setupConstants(),this.setupArguments(arguments),this.validateSettings();for(var t=this.threadDim=c.clone(this.output);t.length<3;)t.push(1);if(this.graphical){var e=this.canvas;if(!e)throw new Error("no canvas available for using graphical output");e.width=t[0],e.height=t[1],this._imageData=this.context.createImageData(t[0],t[1]),this._colorData=new Uint8ClampedArray(t[0]*t[1]*4)}var n=this.getKernelString();this.kernelString=n;try{this.run=new Function([],n).bind(this)()}catch(i){console.error("An error occurred compiling the javascript: ",i)}this.debug&&(console.log("Function output:"),console.log(n))}},{key:"color",value:function(t,e,n,i){"undefined"==typeof i&&(i=1),t=Math.floor(255*t),e=Math.floor(255*e),n=Math.floor(255*n),i=Math.floor(255*i);var r=this.output[0],s=this.output[1],a=this.thread.x,o=s-this.thread.y-1,u=a+o*r;this._colorData[4*u+0]=t,this._colorData[4*u+1]=e,this._colorData[4*u+2]=n,this._colorData[4*u+3]=i}},{key:"getKernelString",value:function(){if(null!==this._kernelString)return this._kernelString;for(var t=this.threadDim||(this.threadDim=c.clone(this.output));t.length<3;)t.push(1);var e=u.fromKernel(this,h),n=e.getPrototypes("kernel"),i=null;n.length>1?n=n.filter(function(t){return/^function/.test(t)?t:(i=t,!1)}):i=n.shift();var r=this._kernelString="\n\t\tconst LOOP_MAX = "+this._getLoopMaxString()+"\n\t\tconst constants = this.constants;\n\t\tconst _this = this;\n    return function ("+this.argumentNames.map(function(t){return"user_"+t}).join(", ")+") {\n      "+this._processConstants()+"\n      "+this._processArguments()+"\n      "+this._kernelLoop(i)+"\n      if (this.graphical) {\n        this._imageData.data.set(this._colorData);\n        this.context.putImageData(this._imageData, 0, 0);\n        return;\n      }\n      "+this._kernelOutput()+"\n      "+(n.length>0?n.join("\n"):"")+"\n    }.bind(this);";return r}},{key:"toString",value:function(){return l(this)}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+";\n":" 1000;\n"}},{key:"_processConstants",value:function(){if(!this.constants)return"";var t=[];for(var e in this.constants){var n=this.constantTypes[e];switch(n){case"HTMLImage":t.push("  const constants_"+e+" = this._imageTo2DArray(this.constants."+e+")");break;case"HTMLImageArray":t.push("  const constants_"+e+" = this._imageTo3DArray(this.constants."+e+")");break;case"Input":t.push("  const constants_"+e+" = this.constants."+e+".value");break;default:t.push("  const constants_"+e+" = this.constants."+e)}}return t.join("\n")}},{key:"_processArguments",value:function(){for(var t=[],e=0;e<this.argumentTypes.length;e++)switch(this.argumentTypes[e]){case"HTMLImage":t.push("  user_"+this.argumentNames[e]+" = this._imageTo2DArray(user_"+this.argumentNames[e]+")");break;case"HTMLImageArray":t.push("  user_"+this.argumentNames[e]+" = this._imageTo3DArray(user_"+this.argumentNames[e]+")");break;case"Input":t.push("  user_"+this.argumentNames[e]+" = user_"+this.argumentNames[e]+".value")}return t.join(";\n")}},{key:"_imageTo2DArray",value:function(t){var e=this.canvas;e.width<t.width&&(e.width=t.width),e.height<t.height&&(e.height=t.height);var n=this.context;n.drawImage(t,0,0,t.width,t.height);for(var i=n.getImageData(0,0,t.width,t.height).data,r=new Array(t.height),s=0,a=t.height-1;a>=0;a--){r[a]=new Array(t.width);for(var o=0;o<t.width;o++){var u=i[s++]/255,h=i[s++]/255,c=i[s++]/255,l=i[s++]/255,p=[u,h,c,l];p.r=u,p.g=h,p.b=c,p.a=l,r[a][o]=p}}return r}},{key:"_imageTo3DArray",value:function(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=this._imageTo2DArray(t[n]);return e}},{key:"_kernelLoop",value:function(t){switch(this.output.length){case 1:return this._kernel1DLoop(t);case 2:return this._kernel2DLoop(t);case 3:return this._kernel3DLoop(t);default:throw new Error("unsupported size kernel")}}},{key:"_kernel1DLoop",value:function(t){var e=this.threadDim;return"const result = new Float32Array("+e[0]+");\n    "+this._mapSubKernels(function(t){return"let subKernelResult_"+t.name+";"}).join("\n")+"\n\t\t"+this._mapSubKernels(function(t){return"const result_"+t.name+" = new Float32Array("+e[0]+");\n"}).join("")+"\n    for (let x = 0; x < "+e[0]+"; x++) {\n      this.thread.x = x;\n      this.thread.y = 0;\n      this.thread.z = 0;\n      let kernelResult;\n      "+t+"\n      result[x] = kernelResult;\n      "+this._mapSubKernels(function(t){return"result_"+t.name+"[x] = subKernelResult_"+t.name+";\n"}).join("")+"\n    }"}},{key:"_kernel2DLoop",value:function(t){var e=this.threadDim;return"const result = new Array("+e[1]+");\n    "+this._mapSubKernels(function(t){return"let subKernelResult_"+t.name+";"}).join("\n")+"\n    "+this._mapSubKernels(function(t){return"const result_"+t.name+" = new Array("+e[1]+");\n"}).join("")+"\n    for (let y = 0; y < "+e[1]+"; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      const resultX = result[y] = new Float32Array("+e[0]+");\n      "+this._mapSubKernels(function(t){return"const result_"+t.name+"X = result_"+t.name+"[y] = new Float32Array("+e[0]+");\n"}).join("")+"\n      for (let x = 0; x < "+e[0]+"; x++) {\n      \tthis.thread.x = x;\n        let kernelResult;\n        "+t+"\n        resultX[x] = kernelResult;\n        "+this._mapSubKernels(function(t){return"result_"+t.name+"X[x] = subKernelResult_"+t.name+";\n"}).join("")+"\n      }\n    }"}},{key:"_kernel3DLoop",value:function(t){var e=this.threadDim;return"const result = new Array("+e[2]+");\n    "+this._mapSubKernels(function(t){return"let subKernelResult_"+t.name+";"}).join("\n")+"\n    "+this._mapSubKernels(function(t){return"const result_"+t.name+" = new Array("+e[2]+");\n"}).join("")+"\n    for (let z = 0; z < "+e[2]+"; z++) {\n      this.thread.z = z;\n      const resultY = result[z] = new Array("+e[1]+");\n      "+this._mapSubKernels(function(t){return"const result_"+t.name+"Y = result_"+t.name+"[z] = new Array("+e[1]+");\n"}).join("")+"\n      for (let y = 0; y < "+e[1]+"; y++) {\n        this.thread.y = y;\n        const resultX = resultY[y] = new Float32Array("+e[0]+");\n        "+this._mapSubKernels(function(t){return"const result_"+t.name+"X = result_"+t.name+"Y[y] = new Float32Array("+e[0]+");\n"}).join("")+"\n        for (let x = 0; x < "+e[0]+"; x++) {\n        \tthis.thread.x = x;\n          let kernelResult;\n          "+t+"\n          resultX[x] = kernelResult;\n          "+this._mapSubKernels(function(t){return"result_"+t.name+"X[x] = subKernelResult_"+t.name+";\n"}).join("")+"\n        }\n      }\n    }"}},{key:"_kernelOutput",value:function(){return this.subKernels?"return {\n      result: result,\n      "+this.subKernels.map(function(t){return t.property+": result_"+t.name}).join(",\n")+"\n    };":"return result;"}},{key:"_mapSubKernels",value:function(t){return null===this.subKernels?[""]:this.subKernels.map(t)}},{key:"destroy",value:function(t){t&&delete this.canvas}}],[{key:"destroyContext",value:function(t){}}]),e}(o);e.exports=p},{"../../utils":24,"../function-builder":5,"../kernel":9,"./function-node":2,"./kernel-string":3}],5:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=function(){function t(e){if(i(this,t),e=e||{},this.rootNode=e.rootNode,this.functionNodes=e.functionNodes||[],this.subKernelNodes=e.subKernelNodes||[],this.nativeFunctions=e.nativeFunctions||{},this.functionMap={},this.rootNode&&(this.functionMap.kernel=this.rootNode),this.functionNodes)for(var n=0;n<this.functionNodes.length;n++)this.functionMap[this.functionNodes[n].name]=this.functionNodes[n];if(this.subKernelNodes)for(var r=0;r<this.subKernelNodes.length;r++)this.functionMap[this.subKernelNodes[r].name]=this.subKernelNodes[r]}return r(t,null,[{key:"fromKernel",value:function(e,n,i){var r=e.argumentNames,s=e.argumentTypes,a=e.argumentSizes,o=e.constants,u=e.constantTypes,h=e.debug,c=e.loopMaxIterations,l=e.nativeFunctions,p=e.output,f=function(t){v.addFunctionNode(new n(t,m))},d=function(t){return v.lookupReturnType(t)},m=Object.assign({isRootKernel:!1,onNestedFunction:f,lookupReturnType:d,constants:o,constantTypes:u,debug:h,loopMaxIterations:c,output:p},i||{}),g=new n(e.fn,Object.assign({},m,{isRootKernel:!0,name:"kernel",argumentNames:r,argumentTypes:s,argumentSizes:a})),x=null;e.functions&&(x=e.functions.map(function(t){return new n(t.source,Object.assign({},m,t.settings))}));var y=null;e.subKernels&&(y=e.subKernels.map(function(t){var e=t.name,i=t.source;return new n(i,Object.assign({},m,{name:e,isSubKernel:!0,isRootKernel:!1}))}));var v=new t({rootNode:g,functionNodes:x,nativeFunctions:l,subKernelNodes:y});return v}}]),r(t,[{key:"addFunctionNode",value:function(t){this.functionMap[t.name]=t,t.isRootKernel&&(this.rootNode=t)}},{key:"traceFunctionCalls",value:function(t,e,n){t=t||"kernel",e=e||[];var i=this.functionMap[t];if(i){var r=e.indexOf(t);if(r===-1){e.push(t),n&&(i.parent=n),i.toString();for(var s=0;s<i.calledFunctions.length;++s)this.traceFunctionCalls(i.calledFunctions[s],e,i)}else{var a=e.splice(r,1)[0];e.push(a)}}return this.nativeFunctions[t]&&(e.indexOf(t)>=0||e.push(t)),e}},{key:"getPrototypeString",value:function(t){return this.getPrototypes(t).join("\n")}},{key:"getPrototypes",value:function(t){return this.rootNode.toString(),t?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(t,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.functionMap))}},{key:"getStringFromFunctionNames",value:function(t){for(var e=[],n=0;n<t.length;++n){var i=this.functionMap[t[n]];i&&e.push(this.functionMap[t[n]].toString())}return e.join("\n")}},{key:"getPrototypesFromFunctionNames",value:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n],r=this.functionMap[i];r?e.push(r.toString()):this.nativeFunctions[i]&&e.push(this.nativeFunctions[i])}return e}},{key:"getString",value:function(t){return t?this.getStringFromFunctionNames(this.traceFunctionCalls(t).reverse()):this.getStringFromFunctionNames(Object.keys(this.functionMap))}},{key:"lookupReturnType",value:function(t){var e=this.functionMap[t];return e&&e.returnType?e.returnType:null}},{key:"lookupArgumentType",value:function(){}}]),t}();e.exports=s},{}],6:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t("../utils"),o=t("acorn"),u=function(){function t(e,n){if(i(this,t),!e)throw new Error("fn parameter is missing");n=n||{},this.fn=e,this.name=n.isRootKernel?"kernel":n.name||a.getFunctionNameFromString(e),this.calledFunctions=[],this.calledFunctionsArguments={},this.isRootKernel=!1,this.isSubKernel=!1,this.parent=null,this.debug=null,this.prototypeOnly=null,this.constants=null,this.output=null,this.declarations={},this.states=[];var r=void 0,s=void 0;if(n&&(n.hasOwnProperty("debug")&&(this.debug=n.debug),n.hasOwnProperty("prototypeOnly")&&(this.prototypeOnly=n.prototypeOnly),n.hasOwnProperty("constants")&&(this.constants=n.constants),n.hasOwnProperty("output")&&(this.output=n.output),n.hasOwnProperty("loopMaxIterations")&&(this.loopMaxIterations=n.loopMaxIterations),n.hasOwnProperty("argumentNames")&&(this.argumentNames=n.argumentNames||[]),n.hasOwnProperty("argumentTypes")&&(this.argumentTypes=r=n.argumentTypes),n.hasOwnProperty("argumentSizes")&&(this.argumentSizes=n.argumentSizes||[]),n.hasOwnProperty("constantTypes")?this.constantTypes=n.constantTypes:this.constantTypes={},n.hasOwnProperty("returnType")&&(s=n.returnType),n.hasOwnProperty("isRootKernel")&&(this.isRootKernel=n.isRootKernel),n.hasOwnProperty("isSubKernel")&&(this.isSubKernel=n.isSubKernel),n.onNestedFunction&&(this.onNestedFunction=n.onNestedFunction),n.lookupReturnType&&(this.lookupReturnType=n.lookupReturnType)),this.validateFn(),!this.name)throw new Error("name could not be set");this.setupArgumentTypes(r),this.returnType||(this.returnType=s||"Number")}return s(t,[{key:"validateFn",value:function(){if("string"!=typeof this.fn)throw new Error("fn not a string");if(!a.isFunctionString(this.fn))throw new Error("fn not a function string")}},{key:"setupArgumentTypes",value:function(t){if(this.argumentNames=a.getArgumentNamesFromString(this.fn),t){if(Array.isArray(t)){if(t.length!==this.argumentNames.length)throw new Error("Invalid argument type array length, against function length -> ("+t.length+","+this.argumentNames.length+")");this.argumentTypes=t}else if("object"===("undefined"==typeof t?"undefined":r(t))){var e=Object.keys(t);if(t.hasOwnProperty("returns")&&(this.returnType=t.returns,e.splice(e.indexOf("returns"),1)),e.length>0&&e.length!==this.argumentNames.length)throw new Error("Invalid argument type array length, against function length -> ("+e.length+","+this.argumentNames.length+")");this.argumentTypes=this.argumentNames.map(function(e){return t.hasOwnProperty(e)?t[e]:"Number"})}}else this.argumentTypes=[]}},{key:"isIdentifierConstant",value:function(t){return!!this.constants&&this.constants.hasOwnProperty(t)}},{key:"isInput",value:function(t){return"Input"===this.argumentTypes[this.argumentNames.indexOf(t)]}},{key:"pushState",value:function(t){this.states.push(t)}},{key:"popState",value:function(t){if(this.state!==t)throw new Error("Cannot popState "+t+" when in "+this.state);this.states.pop()}},{key:"isState",value:function(t){return this.state===t}},{key:"astMemberExpressionUnroll",value:function(t){if("Identifier"===t.type)return t.name;if("ThisExpression"===t.type)return"this";if("MemberExpression"===t.type&&t.object&&t.property)return t.object.hasOwnProperty("name")&&"_"===t.object.name[0]?this.astMemberExpressionUnroll(t.property):this.astMemberExpressionUnroll(t.object)+"."+this.astMemberExpressionUnroll(t.property);if(t.hasOwnProperty("expressions")){var e=t.expressions[0];if("Literal"===e.type&&0===e.value&&2===t.expressions.length)return this.astMemberExpressionUnroll(t.expressions[1])}throw this.astErrorOutput("Unknown astMemberExpressionUnroll",t)}},{key:"getJsAST",value:function(t){if(this.ast)return this.ast;if(t=t||o,null===t)throw"Missing JS to AST parser";var e=Object.freeze(t.parse("var "+this.name+" = "+this.fn+";",{locations:!0}));if(null===e)throw new Error("Failed to parse JS code");var n=e.body[0].declarations[0].init;return this.ast=n,n}},{key:"getArgumentType",value:function(t){var e=this.argumentNames.indexOf(t);if(e===-1)return this.declarations.hasOwnProperty(t)?this.declarations[t]:"Number";if(this.parent){if(this.argumentTypes[e])return this.argumentTypes[e];for(var n=this.parent.calledFunctionsArguments[this.name],i=0;i<n.length;i++){var r=n[i];if(null!==r[e])return this.argumentTypes[e]=r[e].type}}else if(this.argumentTypes[e])return this.argumentTypes[e];return"Number"}},{key:"getConstantType",
value:function(t){return this.constantTypes[t]?this.constantTypes[t]:null}},{key:"getUserArgumentName",value:function(t){var e=this.argumentNames.indexOf(t);if(e===-1)return null;if(!this.parent||!this.isSubKernel)return null;for(var n=this.parent.calledFunctionsArguments[this.name],i=0;i<n.length;i++){var r=n[i],s=r[e];if(null!==s&&"Integer"!==s.type)return s.name}return null}},{key:"toString",value:function(t){throw new Error('"toString" not defined on '+this.constructor.name)}},{key:"astGeneric",value:function(t,e){if(null===t)throw this.astErrorOutput("NULL ast",t);if(Array.isArray(t)){for(var n=0;n<t.length;n++)this.astGeneric(t[n],e);return e}switch(t.type){case"FunctionDeclaration":return this.astFunctionDeclaration(t,e);case"FunctionExpression":return this.astFunctionExpression(t,e);case"ReturnStatement":return this.astReturnStatement(t,e);case"Literal":return this.astLiteral(t,e);case"BinaryExpression":return this.astBinaryExpression(t,e);case"Identifier":return this.astIdentifierExpression(t,e);case"AssignmentExpression":return this.astAssignmentExpression(t,e);case"ExpressionStatement":return this.astExpressionStatement(t,e);case"EmptyStatement":return this.astEmptyStatement(t,e);case"BlockStatement":return this.astBlockStatement(t,e);case"IfStatement":return this.astIfStatement(t,e);case"BreakStatement":return this.astBreakStatement(t,e);case"ContinueStatement":return this.astContinueStatement(t,e);case"ForStatement":return this.astForStatement(t,e);case"WhileStatement":return this.astWhileStatement(t,e);case"DoWhileStatement":return this.astDoWhileStatement(t,e);case"VariableDeclaration":return this.astVariableDeclaration(t,e);case"VariableDeclarator":return this.astVariableDeclarator(t,e);case"ThisExpression":return this.astThisExpression(t,e);case"SequenceExpression":return this.astSequenceExpression(t,e);case"UnaryExpression":return this.astUnaryExpression(t,e);case"UpdateExpression":return this.astUpdateExpression(t,e);case"LogicalExpression":return this.astLogicalExpression(t,e);case"MemberExpression":return this.astMemberExpression(t,e);case"CallExpression":return this.astCallExpression(t,e);case"ArrayExpression":return this.astArrayExpression(t,e);case"DebuggerStatement":return this.astDebuggerStatement(t,e)}throw this.astErrorOutput("Unknown ast type : "+t.type,t)}},{key:"astErrorOutput",value:function(t,e){return new Error(t+":\n"+a.getAstString(this.fn,e))}},{key:"astDebuggerStatement",value:function(t,e){return e}},{key:"astFunctionDeclaration",value:function(t,e){return this.onNestedFunction&&this.onNestedFunction(a.getAstString(this.fn,t)),e}},{key:"astFunctionExpression",value:function(t,e){return e}},{key:"astReturnStatement",value:function(t,e){return e}},{key:"astLiteral",value:function(t,e){return e}},{key:"astBinaryExpression",value:function(t,e){return e}},{key:"astIdentifierExpression",value:function(t,e){return e}},{key:"astAssignmentExpression",value:function(t,e){return e}},{key:"astExpressionStatement",value:function(t,e){return e}},{key:"astEmptyStatement",value:function(t,e){return e}},{key:"astBlockStatement",value:function(t,e){return e}},{key:"astIfStatement",value:function(t,e){return e}},{key:"astBreakStatement",value:function(t,e){return e}},{key:"astContinueStatement",value:function(t,e){return e}},{key:"astForStatement",value:function(t,e){return e}},{key:"astWhileStatement",value:function(t,e){return e}},{key:"astDoWhileStatement",value:function(t,e){return e}},{key:"astVariableDeclaration",value:function(t,e){return e}},{key:"astVariableDeclarator",value:function(t,e){return e}},{key:"astThisExpression",value:function(t,e){return e}},{key:"astSequenceExpression",value:function(t,e){return e}},{key:"astUnaryExpression",value:function(t,e){return e}},{key:"astUpdateExpression",value:function(t,e){return e}},{key:"astLogicalExpression",value:function(t,e){return e}},{key:"astMemberExpression",value:function(t,e){return e}},{key:"astCallExpression",value:function(t,e){return e}},{key:"astArrayExpression",value:function(t,e){return e}},{key:"pushParameter",value:function(t,e){t.push("user_"+e)}},{key:"state",get:function(){return this.states[this.states.length-1]}}]),t}();e.exports=u},{"../utils":24,acorn:25}],7:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("./kernel"),u=function(t){function e(t,n){i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return s.fixIntegerDivisionAccuracy=null,s}return s(e,t),a(e,null,[{key:"getFeatures",value:function(){return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),kernelMap:!1})}},{key:"getIsFloatRead",value:function(){function t(){return 1}var e=new this(t.toString(),{context:this.testContext,canvas:this.testCanvas,skipValidateSettings:!0,output:[2],floatTextures:!0,floatOutput:!0,floatOutputForce:!0}),n=e.run();return e.destroy(!0),1===n[0]}},{key:"getIsIntegerDivisionAccurate",value:function(){function t(t,e){return t[this.thread.x]/e[this.thread.x]}var e=new this(t.toString(),{context:this.testContext,canvas:this.testCanvas,skipValidateSettings:!0,output:[2]}),n=e.run([6,6030401],[3,3991]);return e.destroy(!0),2===n[0]&&1511===n[1]}},{key:"setupFeatureChecks",value:function(){throw new Error('"setupFeatureChecks" not defined on '+this.name)}},{key:"testCanvas",get:function(){throw new Error('"testCanvas" not defined on '+this.name)}},{key:"testContext",get:function(){throw new Error('"testContext" not defined on '+this.name)}},{key:"features",get:function(){throw new Error('"features" not defined on '+this.name)}}]),e}(o);e.exports=u},{"./kernel":9}],8:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("gl"),u=t("../web-gl/kernel"),h=null,c=null,l=null,p=null,f=null,d=function(t){function e(){return i(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),a(e,[{key:"initCanvas",value:function(){return{}}},{key:"initContext",value:function(){var t=o(2,2,{preserveDrawingBuffer:!0});return t}},{key:"initExtensions",value:function(){this.extensions={STACKGL_resize_drawingbuffer:this.context.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:this.context.getExtension("STACKGL_destroy_context"),OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint")}}},{key:"destroyExtensions",value:function(){this.extensions.STACKGL_resize_drawingbuffer=null,this.extensions.STACKGL_destroy_context=null,this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null}}],[{key:"setupFeatureChecks",value:function(){c=null,p=null,"function"==typeof o&&(l=o(2,2,{preserveDrawingBuffer:!0}),p={STACKGL_resize_drawingbuffer:l.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:l.getExtension("STACKGL_destroy_context"),OES_texture_float:l.getExtension("OES_texture_float"),OES_texture_float_linear:l.getExtension("OES_texture_float_linear"),OES_element_index_uint:l.getExtension("OES_element_index_uint")},f=this.getFeatures())}},{key:"isContextMatch",value:function(t){try{return"ANGLE"===t.getParameter(t.RENDERER)}catch(e){return!1}}},{key:"getFeatures",value:function(){var t=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),getIsTextureFloat:!0,isDrawBuffers:t,kernelMap:t})}},{key:"getIsDrawBuffers",value:function(){return Boolean(p.WEBGL_draw_buffers)}},{key:"getMode",value:function(){return"gpu"}},{key:"destroyContext",value:function(t){var e=t.getExtension("STACKGL_destroy_context");e&&e.destroy&&e.destroy()}},{key:"isSupported",get:function(){return null!==h?h:(this.setupFeatureChecks(),h=null!==l)}},{key:"testCanvas",get:function(){return c}},{key:"testContext",get:function(){return l}},{key:"features",get:function(){return f}}]),e}(u);e.exports=d},{"../web-gl/kernel":12,gl:26}],9:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t("../utils"),a=t("../input"),o=function(){function t(e,n){i(this,t),this.argumentNames=s.getArgumentNamesFromString(e),this.fn=e,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.wraparound=null,this.hardcodeConstants=null,this.outputToTexture=null,this.outputImmutable=null,this.texSize=null,this.canvas=null,this.context=null,this.threadDim=null,this.floatTextures=null,this.floatOutput=null,this.floatOutputForce=null,this.skipValidateSettings=!1,this.subKernels=null,this.argumentTypes=null,this.argumentSizes=null,this.constantTypes=null,this.functions=null,this.nativeFunctions=null;for(var r in n)n.hasOwnProperty(r)&&this.hasOwnProperty(r)&&(this[r]=n[r]);n.hasOwnProperty("canvas")&&(this.canvas=n.canvas),n.hasOwnProperty("context")&&(this.context=n.context),n.hasOwnProperty("output")&&this.setOutput(n.output),n.hasOwnProperty("functions")&&(this.functions=n.functions),n.hasOwnProperty("nativeFunctions")&&(this.nativeFunctions=n.nativeFunctions),this.canvas||(this.canvas=this.initCanvas()),this.context||(this.context=this.initContext())}return r(t,[{key:"getMode",value:function(){throw new Error('"getMode" not implemented on '+this.constructor.name)}}],[{key:"isContextMatch",value:function(t){throw new Error('"isContextMatch" not implemented on '+this.name)}},{key:"getFeatures",value:function(){throw new Error('"getFeatures" not implemented on '+this.name)}},{key:"isSupported",get:function(){throw new Error('"isSupported" not implemented on '+this.name)}}]),r(t,[{key:"build",value:function(){throw new Error('"build" not defined on '+this.constructor.name)}},{key:"run",value:function(){throw new Error('"run" not defined on '+this.constructor.name)}},{key:"initCanvas",value:function(){throw new Error('"initCanvas" not defined on '+this.constructor.name)}},{key:"initContext",value:function(){throw new Error('"initContext" not defined on '+this.constructor.name)}},{key:"setupArguments",value:function(t){this.argumentTypes=[],this.argumentSizes=[];for(var e=0;e<t.length;e++){var n=t[e];this.argumentTypes.push(s.getVariableType(n)),this.argumentSizes.push(n.constructor===a?n.size:null)}}},{key:"setupConstants",value:function(){if(this.constantTypes={},this.constants)for(var t in this.constants)this.constantTypes[t]=s.getVariableType(this.constants[t],!0)}},{key:"setOutput",value:function(t){return t.hasOwnProperty("x")?t.hasOwnProperty("y")?t.hasOwnProperty("z")?this.output=[t.x,t.y,t.z]:this.output=[t.x,t.y]:this.output=[t.x]:this.output=t,this}},{key:"setDebug",value:function(t){return this.debug=t,this}},{key:"setGraphical",value:function(t){return this.graphical=t,this}},{key:"setLoopMaxIterations",value:function(t){return this.loopMaxIterations=t,this}},{key:"setFixIntegerDivisionAccuracy",value:function(t){return this.fixIntegerDivisionAccuracy=t,this}},{key:"setConstants",value:function(t){return this.constants=t,this}},{key:"setWraparound",value:function(t){return console.warn("Wraparound mode is not supported and undocumented."),this.wraparound=t,this}},{key:"setHardcodeConstants",value:function(t){return this.hardcodeConstants=t,this}},{key:"setOutputToTexture",value:function(t){return this.outputToTexture=t,this}},{key:"setOutputImmutable",value:function(t){return this.outputImmutable=t,this}},{key:"setFloatTextures",value:function(t){return this.floatTextures=t,this}},{key:"setFloatOutput",value:function(t){return this.floatOutput=t,this}},{key:"setFloatOutputForce",value:function(t){return this.floatOutputForce=t,this}},{key:"setCanvas",value:function(t){return this.canvas=t,this}},{key:"setContext",value:function(t){return this.context=t,this}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getContext",value:function(){return this.context}},{key:"validateSettings",value:function(){throw new Error('"validateSettings" not defined on '+this.constructor.name)}},{key:"exec",value:function(){return this.execute.apply(this,arguments)}},{key:"execute",value:function(){var t=this,e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return new Promise(function(n,i){try{n(t.run.apply(t,e))}catch(r){i(r)}})}},{key:"addSubKernel",value:function(t){if(null===this.subKernels&&(this.subKernels=[]),!t.source)throw new Error('subKernel missing "source" property');if(!t.property&&isNaN(t.property))throw new Error('subKernel missing "property" property');if(!t.name)throw new Error('subKernel missing "name" property');return this.subKernels.push(t),this}},{key:"destroy",value:function(t){throw new Error('"destroy" called on '+this.constructor.name)}},{key:"checkOutput",value:function(){if(!this.output||!Array.isArray(this.output))throw new Error("kernel.output not an array");for(var t=0;t<this.output.length;t++)if(isNaN(this.output[t])||this.output[t]<1)throw new Error(this.constructor.name+".output["+t+"] incorrectly defined as `"+this.output[t]+"`, needs to be numeric, and greater than 0")}}],[{key:"destroyContext",value:function(t){throw new Error('"destroyContext" called on '+this.name)}}]),t}();e.exports=o},{"../input":21,"../utils":24}],10:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){return t.replace(p,"((").replace(f,"((")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t("../function-node"),h=(t("../../utils"),"Math."),c="this.",l="this.constants.",p=/decode32\(\s+encode32\(/g,f=/encode32\(\s+decode32\(/g,d=function(t){function e(t,n){i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return s.fixIntegerDivisionAccuracy=null,n&&n.hasOwnProperty("fixIntegerDivisionAccuracy")&&(s.fixIntegerDivisionAccuracy=n.fixIntegerDivisionAccuracy),s._string=null,s}return s(e,t),o(e,[{key:"toString",value:function(){return this.prototypeOnly?this.astFunctionPrototype(this.getJsAST(),[]).join("").trim():this._string?this._string:this._string=a(this.astGeneric(this.getJsAST(),[]).join("").trim())}},{key:"astFunctionPrototype",value:function(t,e){if(this.isRootKernel||this.isSubKernel)return e;var n=this.returnType,i=m[n];if(!i)throw new Error("unknown type "+n);e.push(i),e.push(" "),e.push(this.name),e.push("(");for(var r=0;r<this.argumentNames.length;++r)r>0&&e.push(", "),e.push(this.argumentTypes[r]),e.push(" "),e.push("user_"),e.push(this.argumentNames[r]);return e.push(");\n"),e}},{key:"astFunctionExpression",value:function(t,e){if(this.isRootKernel)e.push("void");else{var n=this.returnType,i=m[n];if(!i)throw new Error("unknown type "+n);e.push(i)}if(e.push(" "),e.push(this.name),e.push("("),!this.isRootKernel)for(var r=0;r<this.argumentNames.length;++r){var s=this.argumentNames[r];r>0&&e.push(", ");var a=this.getArgumentType(s),o=m[a];if(!o)throw new Error("unknown type "+a);e.push(o),e.push(" "),e.push("user_"),e.push(s)}e.push(") {\n");for(var u=0;u<t.body.body.length;++u)this.astGeneric(t.body.body[u],e),e.push("\n");return e.push("}\n"),e}},{key:"astReturnStatement",value:function(t,e){return this.isRootKernel?(e.push("kernelResult = "),this.astGeneric(t.argument,e),e.push(";"),e.push("return;")):this.isSubKernel?(e.push("subKernelResult_"+this.name+" = "),this.astGeneric(t.argument,e),e.push(";"),e.push("return subKernelResult_"+this.name+";")):(e.push("return "),this.astGeneric(t.argument,e),e.push(";")),e}},{key:"astLiteral",value:function(t,e){if(isNaN(t.value))throw this.astErrorOutput("Non-numeric literal not supported : "+t.value,t);e.push(t.value);var n=this.isState("in-get-call-parameters"),i=this.isState("in-for-loop-init"),r=this.isState("integer-comparison");return Number.isInteger(t.value)?n||i||r||e.push(".0"):n&&!r&&(e.pop(),e.push("int("),e.push(t.value),e.push(")")),e}},{key:"astBinaryExpression",value:function(t,e){var n=this.isState("in-get-call-parameters");if(n&&(this.pushState("not-in-get-call-parameters"),e.push("int")),e.push("("),"%"===t.operator)e.push("mod("),this.astGeneric(t.left,e),e.push(","),this.astGeneric(t.right,e),e.push(")");else if("==="===t.operator)this.astGeneric(t.left,e),e.push("=="),this.astGeneric(t.right,e);else if("!=="===t.operator)this.astGeneric(t.left,e),e.push("!="),this.astGeneric(t.right,e);else if(this.fixIntegerDivisionAccuracy&&"/"===t.operator)e.push("div_with_int_check("),this.astGeneric(t.left,e),e.push(", "),this.astGeneric(t.right,e),e.push(")");else{this.astGeneric(t.left,e),e.push(t.operator);var i="Integer"===this.declarations[this.astGetFirstAvailableName(t.left)];i?(this.pushState("integer-comparison"),this.astGeneric(t.right,e),this.popState("integer-comparison")):this.astGeneric(t.right,e)}return e.push(")"),n&&this.popState("not-in-get-call-parameters"),e}},{key:"astIdentifierExpression",value:function(t,e){if("Identifier"!==t.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",t);var n=!this.isState("in-get-call-parameters");switch(t.name){case"gpu_threadX":n?e.push("float(threadId.x)"):e.push("threadId.x");break;case"gpu_threadY":n?e.push("float(threadId.y)"):e.push("threadId.y");break;case"gpu_threadZ":n?e.push("float(threadId.z)"):e.push("threadId.z");break;case"gpu_outputX":e.push("uOutputDim.x");break;case"gpu_outputY":e.push("uOutputDim.y");break;case"gpu_outputZ":e.push("uOutputDim.z");break;case"Infinity":e.push("3.402823466e+38");break;default:var i=this.getUserArgumentName(t.name);null!==i?this.pushParameter(e,i):this.pushParameter(e,t.name)}return e}},{key:"astForStatement",value:function(t,e){if("ForStatement"!==t.type)throw this.astErrorOutput("Invalid for statment",t);if(t.test&&"BinaryExpression"===t.test.type){if("Identifier"===t.test.right.type&&"<"===t.test.operator&&this.isIdentifierConstant(this.astGetFirstAvailableName(t.test.right))===!1){this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),e.push("for ("),this.pushState("in-for-loop-init"),this.astGeneric(t.init,e),this.popState("in-for-loop-init"),this.astGeneric(t.test.left,e),e.push(t.test.operator),e.push("LOOP_MAX"),e.push(";"),this.astGeneric(t.update,e),e.push(")"),e.push("{\n"),e.push("if (");var n=this.astGetFirstAvailableName(t.test.left);if(this.astGeneric(t.test.left,e),e.push(t.test.operator),"Integer"===this.declarations[n]?(this.pushState("integer-comparison"),this.astGeneric(t.test.right,e),this.popState("integer-comparison")):this.astGeneric(t.test.right,e),e.push(") {\n"),"BlockStatement"===t.body.type)for(var i=0;i<t.body.body.length;i++)this.astGeneric(t.body.body[i],e);else this.astGeneric(t.body,e);return e.push("\n} else {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}if(t.init.declarations){var r=t.init.declarations;if(!Array.isArray(r)||r.length<1)throw new Error("Error: Incompatible for loop declaration");if(r.length>1){e.push("for ("),this.pushState("in-for-loop-init"),e.push("int ");for(var s=0;s<r.length;s++){var a=r[s];s>0&&e.push(","),this.declarations[a.id.name]="Integer",this.astGeneric(a,e)}e.push(";"),this.popState("in-for-loop-init")}else e.push("for ("),this.pushState("in-for-loop-init"),this.astGeneric(t.init,e),this.popState("in-for-loop-init");return this.astGeneric(t.test,e),e.push(";"),this.astGeneric(t.update,e),e.push(")"),this.astGeneric(t.body,e),e}}throw this.astErrorOutput("Invalid for statement",t)}},{key:"astWhileStatement",value:function(t,e){if("WhileStatement"!==t.type)throw this.astErrorOutput("Invalid while statment",t);return e.push("for (int i = 0; i < LOOP_MAX; i++) {"),e.push("if ("),this.astGeneric(t.test,e),e.push(") {\n"),this.astGeneric(t.body,e),e.push("} else {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}},{key:"astDoWhileStatement",value:function(t,e){if("DoWhileStatement"!==t.type)throw this.astErrorOutput("Invalid while statment",t);return e.push("for (int i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(t.body,e),e.push("if (!"),this.astGeneric(t.test,e),e.push(") {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}},{key:"astAssignmentExpression",value:function(t,e){if("%="!==t.operator){var n="Integer"===this.declarations[this.astGetFirstAvailableName(t.left)],i="Integer"===this.declarations[this.astGetFirstAvailableName(t.right)];return this.astGeneric(t.left,e),e.push(t.operator),!n&&i?(e.push("float("),this.astGeneric(t.right,e),e.push(")")):this.astGeneric(t.right,e),e}this.astGeneric(t.left,e),e.push("="),e.push("mod("),this.astGeneric(t.left,e),e.push(","),this.astGeneric(t.right,e),e.push(")")}},{key:"astEmptyStatement",value:function(t,e){return e}},{key:"astBlockStatement",value:function(t,e){e.push("{\n");for(var n=0;n<t.body.length;n++)this.astGeneric(t.body[n],e);return e.push("}\n"),e}},{key:"astExpressionStatement",value:function(t,e){return this.astGeneric(t.expression,e),e.push(";"),e}},{key:"astVariableDeclaration",value:function(t,e){for(var n=0;n<t.declarations.length;n++){var i=t.declarations[n];n>0&&e.push(",");var r=[];this.astGeneric(i,r);var s=this.isState("in-for-loop-init")?"Integer":"Number";if(0===n){var a=i.init;if(a)if(a.object){if("MemberExpression"===a.object.type&&a.object.object)if("ThisExpression"!==a.object.object.type||!a.object.property||"thread"!==a.object.property.name&&"output"!==a.object.property.name){if("Identifier"===a.object.object.type){var o=this.getArgumentType(a.object.object.name);s=g[o]}else if(a.object.object.object&&"Identifier"===a.object.object.object.type){var u=this.getArgumentType(a.object.object.object.name);s=g[u]}else if(a.object.object.object&&a.object.object.object.object&&"ThisExpression"===a.object.object.object.object.type&&"constants"===a.object.object.object.property.name){var h=this.getConstantType(a.object.object.property.name);s=g[h]}else if(a.object.object.object&&a.object.object.object.object&&a.object.object.object.object.object&&"ThisExpression"===a.object.object.object.object.object.type&&"constants"===a.object.object.object.object.property.name){var c=this.getConstantType(a.object.object.object.property.name);s=g[c]}}else s="Float";if(!s)throw new Error("unknown lookup type "+g)}else if(a.name&&this.declarations[a.name])s=this.declarations[a.name];else if("ArrayExpression"===a.type)s="Array("+a.elements.length+")";else if("CallExpression"===a.type&&this.lookupReturnType){var l=this.lookupReturnType(a.callee.name);l&&(s=l)}var p=m[s];if(!p)throw new Error("type "+s+" not handled");e.push(p+" ")}this.declarations[i.id.name]=s,e.push.apply(e,r)}return e.push(";"),e}},{key:"astVariableDeclarator",value:function(t,e){return this.astGeneric(t.id,e),null!==t.init&&(e.push("="),this.astGeneric(t.init,e)),e}},{key:"astIfStatement",value:function(t,e){return e.push("if ("),this.astGeneric(t.test,e),e.push(")"),"BlockStatement"===t.consequent.type?this.astGeneric(t.consequent,e):(e.push(" {\n"),this.astGeneric(t.consequent,e),e.push("\n}\n")),t.alternate&&(e.push("else "),"BlockStatement"===t.alternate.type?this.astGeneric(t.alternate,e):(e.push(" {\n"),this.astGeneric(t.alternate,e),e.push("\n}\n"))),e}},{key:"astBreakStatement",value:function(t,e){return e.push("break;\n"),e}},{key:"astContinueStatement",value:function(t,e){return e.push("continue;\n"),e}},{key:"astLogicalExpression",value:function(t,e){return e.push("("),this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e.push(")"),e}},{key:"astUpdateExpression",value:function(t,e){return t.prefix?(e.push(t.operator),this.astGeneric(t.argument,e)):(this.astGeneric(t.argument,e),e.push(t.operator)),e}},{key:"astUnaryExpression",value:function(t,e){return t.prefix?(e.push(t.operator),this.astGeneric(t.argument,e)):(this.astGeneric(t.argument,e),e.push(t.operator)),e}},{key:"astThisExpression",value:function(t,e){return e.push("this"),e}},{key:"astMemberExpression",value:function(t,e){if(t.computed)if("Identifier"===t.object.type||"MemberExpression"===t.object.type&&t.object.object.object&&"ThisExpression"===t.object.object.object.type&&"constants"===t.object.object.property.name){var n=t.object.name,i=!1;if(this.argumentNames){var r=this.argumentNames.indexOf(n);r>=0&&"Number"===this.argumentTypes[r]&&(i=!0)}if(i)this.astGeneric(t.object,e),e.push("[int("),this.astGeneric(t.property,e),e.push(")]");else{var s=this.isState("in-get-call-parameters"),a=this.isState("multi-member-expression");a&&this.popState("multi-member-expression"),this.pushState("not-in-get-call-parameters");var o=null;switch(t.object.name?o=this.declarations[t.object.name]?this.declarations[t.object.name]:this.getArgumentType(t.object.name):t.object&&t.object.object&&t.object.object.object&&"ThisExpression"===t.object.object.object.type&&(o=this.getConstantType(t.object.property.name)),o){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(t.object,e),e.push("["),e.push(t.property.raw),e.push("]"),a&&this.popState("not-in-get-call-parameters");break;case"HTMLImageArray":e.push("getImage3D("),this.astGeneric(t.object,e),e.push(", "),this.astGeneric(t.object,e),e.push("Size, "),this.astGeneric(t.object,e),e.push("Dim, "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(t.property,e),a||this.popState("in-get-call-parameters"),e.push(")");break;case"ArrayTexture(4)":case"HTMLImage":e.push("getImage2D("),this.astGeneric(t.object,e),e.push(", "),this.astGeneric(t.object,e),e.push("Size, "),this.astGeneric(t.object,e),e.push("Dim, "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(t.property,e),a||this.popState("in-get-call-parameters"),e.push(")");break;default:s&&e.push("int("),e.push("get("),this.astGeneric(t.object,e),e.push(", "),this.astGeneric(t.object,e),e.push("Size, "),this.astGeneric(t.object,e),e.push("Dim, "),this.astGeneric(t.object,e),e.push("BitRatio, "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(t.property,e),a||this.popState("in-get-call-parameters"),e.push(")"),s&&e.push(")")}}}else{var u=this.isState("in-get-call-parameters");u||this.pushState("multi-member-expression"),this.astGeneric(t.object,e),this.isState("multi-member-expression")&&this.popState("multi-member-expression");var h=!u&&this.isState("in-get-call-parameters"),c=e.pop();e.push(", ");var p=this.isState("should-pop-in-get-call-parameters");p&&this.popState("should-pop-in-get-call-parameters"),this.astGeneric(t.property,e),e.push(c),h?this.pushState("should-pop-in-get-call-parameters"):p&&this.popState("in-get-call-parameters")}else{var f=this.astMemberExpressionUnroll(t),d=f.toLowerCase();if(0===f.indexOf(l)){var m=f.slice(l.length),g=this.isState("integer-comparison");f=!g&&this.constantTypes&&"Integer"===this.constantTypes[m]?"float(constants_"+m+")":"constants_"+m}var x=!this.isState("in-get-call-parameters"),y=this.isState("integer-comparison");switch(d){case"this.thread.x":x?e.push("float(threadId.x)"):e.push("threadId.x");break;case"this.thread.y":x?e.push("float(threadId.y)"):e.push("threadId.y");break;case"this.thread.z":x?e.push("float(threadId.z)"):e.push("threadId.z");break;case"this.output.x":y?e.push(this.output[0]):e.push(this.output[0]+".0");break;case"this.output.y":y?e.push(this.output[1]):e.push(this.output[1]+".0");break;case"this.output.z":y?e.push(this.output[2]):e.push(this.output[2]+".0");break;default:t.object&&t.object.name&&this.declarations[t.object.name]&&e.push("user_"),e.push(f)}}return e}},{key:"astSequenceExpression",value:function(t,e){for(var n=0;n<t.expressions.length;n++)n>0&&e.push(","),this.astGeneric(t.expressions,e);return e}},{key:"astCallExpression",value:function(t,e){if(t.callee){var n=this.astMemberExpressionUnroll(t.callee);0===n.indexOf(h)&&(n=n.slice(h.length)),0===n.indexOf(c)&&(n=n.slice(c.length)),"atan2"===n&&(n="atan"),this.calledFunctions.indexOf(n)<0&&this.calledFunctions.push(n),this.hasOwnProperty("funcName")||(this.calledFunctionsArguments[n]=[]);var i=[];this.calledFunctionsArguments[n].push(i),e.push(n),e.push("(");for(var r=0;r<t.arguments.length;++r){var s=t.arguments[r];if(r>0&&e.push(", "),this.astGeneric(s,e),"Identifier"===s.type){var a=this.argumentNames.indexOf(s.name);a===-1?i.push(null):i.push({name:s.name,type:this.argumentTypes[a]||"Number"})}else i.push(null)}return e.push(")"),e}throw this.astErrorOutput("Unknown CallExpression",t)}},{key:"astArrayExpression",value:function(t,e){var n=t.elements.length;e.push("vec"+n+"(");for(var i=0;i<n;++i){i>0&&e.push(", ");var r=t.elements[i];this.astGeneric(r,e)}return e.push(")"),e}},{key:"pushParameter",value:function(t,e){var n=this.getArgumentType(e);return(this.isState("in-get-call-parameters")||this.isState("integer-comparison"))&&"Integer"!==n&&"Array"!==n?void t.push("int(user_"+e+")"):void t.push("user_"+e)}},{key:"astGetFirstAvailableName",value:function(t){return t.name?t.name:null}},{key:"build",value:function(){return this.toString().length>0}}]),e}(u),m={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4",Array2D:"sampler2D",Array3D:"sampler2D",Float:"float",Input:"sampler2D",Integer:"int",Number:"float",NumberTexture:"sampler2D","ArrayTexture(4)":"sampler2D"},g={Array:"Number",Array2D:"Number",Array3D:"Number",HTMLImage:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number","ArrayTexture(4)":"Array(4)"
};e.exports=d},{"../../utils":24,"../function-node":6}],11:[function(t,e,n){function i(t){return/^function /.test(t)&&(t=t.substring(9)),t.replace(/[_]typeof/g,"typeof")}function r(t){return t.replace(/^[A-Za-z23]+/,"function").replace(/[_]typeof/g,"typeof")}function s(t){return t?"true":t===!1?"false":"null"}var a=t("../../utils"),o=t("../../kernel-run-shortcut");e.exports=function(t,e){return"() => {\n    "+o.toString()+";\n    const utils = {\n      allPropertiesOf: "+r(a.allPropertiesOf.toString())+",\n      clone: "+r(a.clone.toString())+",\n      splitArray: "+r(a.splitArray.toString())+",\n      getVariableType: "+r(a.getVariableType.toString())+",\n      getDimensions: "+r(a.getDimensions.toString())+",\n      dimToTexSize: "+r(a.dimToTexSize.toString())+",\n      flattenTo: "+r(a.flattenTo.toString())+",\n      flatten2dArrayTo: "+r(a.flatten2dArrayTo.toString())+",\n      flatten3dArrayTo: "+r(a.flatten3dArrayTo.toString())+",\n      systemEndianness: "+r(a.getSystemEndianness.toString())+",\n      isArray: "+r(a.isArray.toString())+"\n    };\n    const Utils = utils;\n    const canvases = [];\n    const maxTexSizes = {};\n    let Texture = function() {};\n    let Input = function() {}; \n    class "+(e||"Kernel")+" {\n      constructor() {\n        this.maxTexSize = null;\n        this.argumentsLength = 0;\n        this.constantsLength = 0;\n        this.canvas = null;\n        this.context = null;\n        this.program = null;\n        this.subKernels = null;\n        this.subKernelNames = null;\n        this.wraparound = null;\n        this.drawBuffersMap = "+(t.drawBuffersMap?JSON.stringify(t.drawBuffersMap):"null")+";\n        this.endianness = '"+t.endianness+"';\n        this.graphical = "+s(t.graphical)+";\n        this.floatTextures = "+s(t.floatTextures)+";\n        this.floatOutput = "+s(t.floatOutput)+";\n        this.floatOutputForce = "+s(t.floatOutputForce)+";\n        this.hardcodeConstants = "+s(t.hardcodeConstants)+";\n        this.outputToTexture = "+s(t.outputToTexture)+";\n        this.argumentNames = "+JSON.stringify(t.argumentNames)+";\n        this.argumentTypes = "+JSON.stringify(t.argumentTypes)+";\n        this.texSize = "+JSON.stringify(t.texSize)+";\n        this.output = "+JSON.stringify(t.output)+";\n        this.compiledFragShaderString = `"+t.compiledFragShaderString+"`;\n\t\t    this.compiledVertShaderString = `"+t.compiledVertShaderString+"`;\n\t\t    this.programUniformLocationCache = {};\n\t\t    this.textureCache = {};\n\t\t    this.subKernelOutputTextures = null;\n\t\t    this.extensions = {};\n\t\t    this.uniform1fCache = {};\n\t\t    this.uniform1iCache = {};\n\t\t    this.uniform2fCache = {};\n\t\t    this.uniform2fvCache = {};\n\t\t    this.uniform2ivCache = {};\n\t\t    this.uniform3fvCache = {};\n\t\t    this.uniform3ivCache = {};\n      }\n      _getFragShaderString() { return this.compiledFragShaderString; }\n      _getVertShaderString() { return this.compiledVertShaderString; }\n      validateSettings() {}\n      initExtensions() {}\n      setupArguments() {}\n      setupConstants() {}\n      setCanvas(canvas) { this.canvas = canvas; return this; }\n      setContext(context) { this.context = context; return this; }\n      setTexture(Type) { Texture = Type; }\n      setInput(Type) { Input = Type; }\n      "+i(t.getUniformLocation.toString())+"\n      "+i(t.build.toString())+"\n\t\t  "+i(t.run.toString())+"\n\t\t  "+i(t._addArgument.toString())+"\n\t\t  "+i(t._formatArrayTransfer.toString())+"\n\t\t  "+i(t.checkOutput.toString())+"\n\t\t  "+i(t.getArgumentTexture.toString())+"\n\t\t  "+i(t.getTextureCache.toString())+"\n\t\t  "+i(t.getOutputTexture.toString())+"\n\t\t  "+i(t.renderOutput.toString())+"\n\t\t  "+i(t.updateMaxTexSize.toString())+"\n\t\t  "+i(t._setupOutputTexture.toString())+"\n\t\t  "+i(t.detachTextureCache.toString())+"\n\t\t  "+i(t.setUniform1f.toString())+"\n\t\t  "+i(t.setUniform1i.toString())+"\n\t\t  "+i(t.setUniform2f.toString())+"\n\t\t  "+i(t.setUniform2fv.toString())+"\n\t\t  "+i(t.setUniform2iv.toString())+"\n\t\t  "+i(t.setUniform3fv.toString())+"\n\t\t  "+i(t.setUniform3iv.toString())+"\n    };\n    return kernelRunShortcut(new "+(e||"Kernel")+"());\n  };"}},{"../../kernel-run-shortcut":22,"../../utils":24}],12:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("../gl-kernel"),u=t("../function-builder"),h=t("./function-node"),c=t("../../utils"),l=t("../../texture"),p=t("./shader-frag"),f=t("./shader-vert"),d=t("./kernel-string"),m=null,g=null,x=null,y=null,v=null,_=[],E={},T=function(t){function e(t,n){i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return s.textureCache={},s.threadDim={},s.programUniformLocationCache={},s.framebuffer=null,s.buffer=null,s.program=null,s.outputToTexture=n.outputToTexture,s.endianness=c.systemEndianness(),s.extensions={},s.subKernelOutputTextures=null,s.argumentsLength=0,s.constantsLength=0,s.compiledFragShaderString=null,s.compiledVertShaderString=null,s.fragShader=null,s.vertShader=null,s.drawBuffersMap=null,s.outputTexture=null,s.maxTexSize=null,s.uniform1fCache={},s.uniform1iCache={},s.uniform2fCache={},s.uniform2fvCache={},s.uniform2ivCache={},s.uniform3fvCache={},s.uniform3ivCache={},n.context?s.context=n.context:s.context=s.initContext(),s}return s(e,t),a(e,null,[{key:"setupFeatureChecks",value:function(){"undefined"!=typeof document?g=document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas&&(g=new OffscreenCanvas(0,0)),g&&(x=g.getContext("webgl")||g.getContext("experimental-webgl"),y={OES_texture_float:x.getExtension("OES_texture_float"),OES_texture_float_linear:x.getExtension("OES_texture_float_linear"),OES_element_index_uint:x.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:x.getExtension("WEBGL_draw_buffers")},v=this.getFeatures())}},{key:"isContextMatch",value:function(t){return"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext}},{key:"getFeatures",value:function(){var t=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isTextureFloat:this.getIsTextureFloat(),isDrawBuffers:t,kernelMap:t})}},{key:"getIsTextureFloat",value:function(){return Boolean(y.OES_texture_float)}},{key:"getIsDrawBuffers",value:function(){return Boolean(y.WEBGL_draw_buffers)}},{key:"getMode",value:function(){return"gpu"}},{key:"isSupported",get:function(){return null!==m?m:(this.setupFeatureChecks(),m=this.isContextMatch(x))}},{key:"testCanvas",get:function(){return g}},{key:"testContext",get:function(){return x}},{key:"features",get:function(){return v}},{key:"fragShaderString",get:function(){return p}},{key:"vertShaderString",get:function(){return f}}]),a(e,[{key:"initCanvas",value:function(){if("undefined"!=typeof document){var t=document.createElement("canvas");return t.width=2,t.height=2,t}if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(0,0)}},{key:"initContext",value:function(){var t={alpha:!1,depth:!1,antialias:!1},e=this.canvas.getContext("webgl",t)||this.canvas.getContext("experimental-webgl",t);return e}},{key:"initExtensions",value:function(){this.extensions={OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers")}}},{key:"validateSettings",value:function(){if(this.skipValidateSettings)return void(this.texSize=c.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0));var t=this.constructor.features;if(this.floatTextures===!0&&!t.isTextureFloat)throw new Error("Float textures are not supported");if(this.floatOutput===!0&&this.floatOutputForce!==!0&&!t.isFloatRead)throw new Error("Float texture outputs are not supported");if(void 0===this.floatTextures&&t.isTextureFloat&&(this.floatTextures=!0,this.floatOutput=t.isFloatRead),this.subKernels&&this.subKernels.length>0&&!this.extensions.WEBGL_draw_buffers)throw new Error("could not instantiate draw buffers extension");if(null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=!t.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&t.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var e=c.getVariableType(arguments[0]);if("Array"===e)this.output=c.getDimensions(e);else{if("NumberTexture"!==e&&"ArrayTexture(4)"!==e)throw new Error("Auto output not supported for input type: "+e);this.output=arguments[0].output}}if(this.texSize=c.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=c.clone(this.output)}else void 0===this.floatOutput&&t.isTextureFloat&&(this.floatOutput=!0)}},{key:"updateMaxTexSize",value:function(){var t=this.texSize,e=this.canvas;if(null===this.maxTexSize){var n=_.indexOf(e);n===-1&&(n=_.length,_.push(e),E[n]=[t[0],t[1]]),this.maxTexSize=E[n]}this.maxTexSize[0]<t[0]&&(this.maxTexSize[0]=t[0]),this.maxTexSize[1]<t[1]&&(this.maxTexSize[1]=t[1])}},{key:"build",value:function(){this.initExtensions(),this.validateSettings(),this.setupConstants(),this.setupArguments(arguments),this.updateMaxTexSize();var t=this.texSize,e=this.context,n=this.canvas;e.enable(e.SCISSOR_TEST),e.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),n.width=this.maxTexSize[0],n.height=this.maxTexSize[1];for(var i=this.threadDim=c.clone(this.output);i.length<3;)i.push(1);var r=this._getVertShaderString(arguments),s=e.createShader(e.VERTEX_SHADER);e.shaderSource(s,r),e.compileShader(s),this.vertShader=s;var a=this._getFragShaderString(arguments),o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,a),e.compileShader(o),this.fragShader=o,this.debug&&(console.log("GLSL Shader Output:"),console.log(a)),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Error compiling vertex shader: "+e.getShaderInfoLog(s));if(!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("Error compiling fragment shader: "+e.getShaderInfoLog(o));var u=this.program=e.createProgram();e.attachShader(u,s),e.attachShader(u,o),e.linkProgram(u),this.framebuffer=e.createFramebuffer(),this.framebuffer.width=t[0],this.framebuffer.height=t[1];var h=new Float32Array([-1,-1,1,-1,-1,1,1,1]),l=new Float32Array([0,0,1,0,0,1,1,1]),p=h.byteLength,f=this.buffer;f?e.bindBuffer(e.ARRAY_BUFFER,f):(f=this.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f),e.bufferData(e.ARRAY_BUFFER,h.byteLength+l.byteLength,e.STATIC_DRAW)),e.bufferSubData(e.ARRAY_BUFFER,0,h),e.bufferSubData(e.ARRAY_BUFFER,p,l);var d=e.getAttribLocation(this.program,"aPos");e.enableVertexAttribArray(d),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0);var m=e.getAttribLocation(this.program,"aTexCoord");e.enableVertexAttribArray(m),e.vertexAttribPointer(m,2,e.FLOAT,!1,0,p),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer);for(var g in this.constants){var x=this.constants[g],y=c.getVariableType(x,!0);"Float"!==y&&"Integer"!==y&&(e.useProgram(this.program),this._addConstant(this.constants[g],y,g))}this.outputImmutable||(this._setupOutputTexture(),null!==this.subKernels&&this.subKernels.length>0&&this._setupSubOutputTextures(this.subKernels.length))}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var t=this.argumentNames,e=this.argumentTypes,n=this.texSize,i=this.context;i.useProgram(this.program),i.scissor(0,0,n[0],n[1]),this.hardcodeConstants||(this.setUniform3iv("uOutputDim",this.threadDim),this.setUniform2iv("uTexSize",n)),this.setUniform2f("ratio",n[0]/this.maxTexSize[0],n[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var r=0;r<t.length;r++)this._addArgument(arguments[r],e[r],t[r]);if(this.graphical)return this.outputToTexture?(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputTexture&&!this.outputImmutable||this._setupOutputTexture(),i.drawArrays(i.TRIANGLE_STRIP,0,4),new l(this.outputTexture,n,this.threadDim,this.output,this.context,"ArrayTexture(4)")):(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),void i.drawArrays(i.TRIANGLE_STRIP,0,4));i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputImmutable&&this._setupOutputTexture();var s=this.outputTexture;if(null!==this.subKernels&&(this.outputImmutable&&(this.subKernelOutputTextures=[],this._setupSubOutputTextures(this.subKernels.length)),this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap)),i.drawArrays(i.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures&&null!==this.subKernels){for(var a={result:this.renderOutput(s)},o=0;o<this.subKernels.length;o++)a[this.subKernels[o].property]=new l(this.subKernelOutputTextures[o],n,this.threadDim,this.output,this.context);return a}return this.renderOutput(s)}},{key:"renderOutput",value:function(t){var e=this.texSize,n=this.context,i=this.threadDim,r=this.output;if(this.outputToTexture)return new l(t,e,this.threadDim,r,this.context);var s=void 0;if(this.floatOutput){var a=e[0],o=Math.ceil(e[1]/4);s=new Float32Array(a*o*4),n.readPixels(0,0,a,o,n.RGBA,n.FLOAT,s)}else{var u=new Uint8Array(e[0]*e[1]*4);n.readPixels(0,0,e[0],e[1],n.RGBA,n.UNSIGNED_BYTE,u),s=new Float32Array(u.buffer)}if(s=s.subarray(0,i[0]*i[1]*i[2]),1===r.length)return s;if(2===r.length)return c.splitArray(s,r[0]);if(3===r.length){var h=c.splitArray(s,r[0]*r[1]);return h.map(function(t){return c.splitArray(t,r[0])})}}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var t=this.context,e=this.texSize,n=this.outputTexture=this.context.createTexture();t.activeTexture(t.TEXTURE0+this.constantsLength+this.argumentNames.length),t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}},{key:"_setupSubOutputTextures",value:function(t){for(var e=this.context,n=this.texSize,i=this.drawBuffersMap=[e.COLOR_ATTACHMENT0],r=this.subKernelOutputTextures=[],s=0;s<t;s++){var a=this.context.createTexture();r.push(a),i.push(e.COLOR_ATTACHMENT0+s+1),e.activeTexture(e.TEXTURE0+this.constantsLength+this.argumentNames.length+s),e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n[0],n[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n[0],n[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+s+1,e.TEXTURE_2D,a,0)}}},{key:"getArgumentTexture",value:function(t){return this.getTextureCache("ARGUMENT_"+t)}},{key:"getTextureCache",value:function(t){return this.textureCache.hasOwnProperty(t)?this.textureCache[t]:this.textureCache[t]=this.context.createTexture()}},{key:"detachTextureCache",value:function(t){delete this.textureCache[t]}},{key:"setUniform1f",value:function(t,e){if(this.uniform1fCache.hasOwnProperty(t)){var n=this.uniform1fCache[t];if(e===n)return}this.uniform1fCache[t]=e;var i=this.getUniformLocation(t);this.context.uniform1f(i,e)}},{key:"setUniform1i",value:function(t,e){if(this.uniform1iCache.hasOwnProperty(t)){var n=this.uniform1iCache[t];if(e===n)return}this.uniform1iCache[t]=e;var i=this.getUniformLocation(t);this.context.uniform1i(i,e)}},{key:"setUniform2f",value:function(t,e,n){if(this.uniform2fCache.hasOwnProperty(t)){var i=this.uniform2fCache[t];if(e===i[0]&&n===i[1])return}this.uniform2fCache[t]=[e,n];var r=this.getUniformLocation(t);this.context.uniform2f(r,e,n)}},{key:"setUniform2fv",value:function(t,e){if(this.uniform2fvCache.hasOwnProperty(t)){var n=this.uniform2fvCache[t];if(e[0]===n[0]&&e[1]===n[1])return}this.uniform2fvCache[t]=e;var i=this.getUniformLocation(t);this.context.uniform2fv(i,e)}},{key:"setUniform2iv",value:function(t,e){if(this.uniform2ivCache.hasOwnProperty(t)){var n=this.uniform2ivCache[t];if(e[0]===n[0]&&e[1]===n[1])return}this.uniform2ivCache[t]=e;var i=this.getUniformLocation(t);this.context.uniform2iv(i,e)}},{key:"setUniform3fv",value:function(t,e){if(this.uniform3fvCache.hasOwnProperty(t)){var n=this.uniform3fvCache[t];if(e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2])return}this.uniform3fvCache[t]=e;var i=this.getUniformLocation(t);this.context.uniform3fv(i,e)}},{key:"setUniform3iv",value:function(t,e){if(this.uniform3ivCache.hasOwnProperty(t)){var n=this.uniform3ivCache[t];if(e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2])return}this.uniform3ivCache[t]=e;var i=this.getUniformLocation(t);this.context.uniform3iv(i,e)}},{key:"getUniformLocation",value:function(t){return this.programUniformLocationCache.hasOwnProperty(t)?this.programUniformLocationCache[t]:this.programUniformLocationCache[t]=this.context.getUniformLocation(this.program,t)}},{key:"_getFragShaderArtifactMap",value:function(t){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),GET_WRAPAROUND:this._getGetWraparoundString(),GET_TEXTURE_CHANNEL:this._getGetTextureChannelString(),GET_TEXTURE_INDEX:this._getGetTextureIndexString(),GET_RESULT:this._getGetResultString(),MAIN_ARGUMENTS:this._getMainArgumentsString(t),MAIN_CONSTANTS:this._getMainConstantsString(),KERNEL:this._getKernelString(),MAIN_RESULT:this._getMainResultString()}}},{key:"_addArgument",value:function(t,e,n){var i=this.context,r=this.getArgumentTexture(n);switch(t instanceof l&&(e=t.type),e){case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"Array2D":case"Array3D":var s=c.getDimensions(t,!0),a=c.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},s);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var o=a[0]*a[1],u=this._formatArrayTransfer(t,o),h=u.valuesFlat,p=u.bitRatio,f=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,a[0],a[1],0,i.RGBA,i.FLOAT,h):(f=new Uint8Array(h.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,a[0]/p,a[1],0,i.RGBA,i.UNSIGNED_BYTE,f)),this.hardcodeConstants||(this.setUniform3iv("user_"+n+"Dim",s),this.setUniform2iv("user_"+n+"Size",a)),this.setUniform1i("user_"+n+"BitRatio",p),this.setUniform1i("user_"+n,this.argumentsLength);break;case"Integer":case"Float":case"Number":this.setUniform1f("user_"+n,t);break;case"Input":var d=t,m=d.size,g=c.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},m);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var x=g[0]*g[1],y=this._formatArrayTransfer(t.value,x),v=y.valuesFlat,_=y.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g[0],g[1],0,i.RGBA,i.FLOAT,d);else{var E=new Uint8Array(v.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g[0]/_,g[1],0,i.RGBA,i.UNSIGNED_BYTE,E)}this.hardcodeConstants||(this.setUniform3iv("user_"+n+"Dim",m),this.setUniform2iv("user_"+n+"Size",g)),this.setUniform1i("user_"+n+"BitRatio",_),this.setUniform1i("user_"+n,this.argumentsLength);break;case"HTMLImage":var T=t,b=[T.width,T.height,1],S=[T.width,T.height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var k=0,A=i.RGBA,R=i.RGBA,w=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,k,A,R,w,T),this.setUniform3iv("user_"+n+"Dim",b),this.setUniform2iv("user_"+n+"Size",S),this.setUniform1i("user_"+n,this.argumentsLength);break;case"ArrayTexture(4)":case"NumberTexture":var C=t;if(C.context!==this.context)throw new Error("argument "+n+" ("+e+") must be from same context");var I=C.dimensions,D=C.size;i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,C.texture),this.setUniform3iv("user_"+n+"Dim",I),this.setUniform2iv("user_"+n+"Size",D),this.setUniform1i("user_"+n+"BitRatio",1),this.setUniform1i("user_"+n,this.argumentsLength);break;default:throw new Error("Input type not supported: "+t)}this.argumentsLength++}},{key:"_addConstant",value:function(t,e,n){var i=this.context,r=this.getArgumentTexture(n);switch(t instanceof l&&(e=t.type),e){case"Array":var s=c.getDimensions(t,!0),a=c.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},s);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var o=a[0]*a[1],u=this._formatArrayTransfer(t,o),h=u.valuesFlat,p=u.bitRatio,f=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,a[0],a[1],0,i.RGBA,i.FLOAT,h):(f=new Uint8Array(h.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,a[0]/p,a[1],0,i.RGBA,i.UNSIGNED_BYTE,f)),this.hardcodeConstants||(this.setUniform3iv("constants_"+n+"Dim",s),this.setUniform2iv("constants_"+n+"Size",a)),this.setUniform1i("constants_"+n+"BitRatio",p),this.setUniform1i("constants_"+n,this.constantsLength);break;case"Input":var d=t,m=d.size,g=c.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},m);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var x=g[0]*g[1],y=this._formatArrayTransfer(t.value,x),v=y.valuesFlat,_=y.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g[0],g[1],0,i.RGBA,i.FLOAT,inputArray);else{var E=new Uint8Array(v.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g[0]/_,g[1],0,i.RGBA,i.UNSIGNED_BYTE,E)}this.hardcodeConstants||(this.setUniform3iv("constants_"+n+"Dim",m),this.setUniform2iv("constants_"+n+"Size",g)),this.setUniform1i("constants_"+n+"BitRatio",_),this.setUniform1i("constants_"+n,this.constantsLength);break;case"HTMLImage":var T=t,b=[T.width,T.height,1],S=[T.width,T.height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var k=0,A=i.RGBA,R=i.RGBA,w=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,k,A,R,w,T),this.setUniform3iv("constants_"+n+"Dim",b),this.setUniform2iv("constants_"+n+"Size",S),this.setUniform1i("constants_"+n,this.constantsLength);break;case"ArrayTexture(4)":case"NumberTexture":var C=t;if(C.context!==this.context)throw new Error("argument "+n+" ("+e+") must be from same context");var I=C.dimensions,D=C.size;i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,C.texture),this.setUniform3iv("constants_"+n+"Dim",I),this.setUniform2iv("constants_"+n+"Size",D),this.setUniform1i("constants_"+n+"BitRatio",1),this.setUniform1i("constants_"+n,this.constantsLength);break;case"Integer":case"Float":default:throw new Error("Input type not supported: "+t)}this.constantsLength++}},{key:"_formatArrayTransfer",value:function(t,e){var n=1,i=t;if(c.isArray(t[0])||this.floatTextures)i=new Float32Array(e),c.flattenTo(t,i);else switch(t.constructor){case Uint8Array:case Int8Array:n=4;break;case Uint16Array:case Int16Array:n=2;case Float32Array:case Int32Array:break;default:i=new Float32Array(e),c.flattenTo(t,i)}return{bitRatio:n,valuesFlat:i}}},{key:"_getHeaderString",value:function(){return null!==this.subKernels?"#extension GL_EXT_draw_buffers : require\n":""}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+";\n":" 1000;\n"}},{key:"_getConstantsString",value:function(){var t=[],e=this.threadDim,n=this.texSize;return this.hardcodeConstants?t.push("ivec3 uOutputDim = ivec3("+e[0]+", "+e[1]+", "+e[2]+")","ivec2 uTexSize = ivec2("+n[0]+", "+n[1]+")"):t.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"),this._linesToString(t)}},{key:"_getTextureCoordinate",value:function(){var t=this.subKernels;return null===t||t.length<1?"varying vec2 vTexCoord;\n":"out vec2 vTexCoord;\n"}},{key:"_getDecode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getEncode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getDivideWithIntegerCheckString",value:function(){return this.fixIntegerDivisionAccuracy?"float div_with_int_check(float x, float y) {\n  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\n    return float(int(x)/int(y));\n  }\n  return x / y;\n}":""}},{key:"_getGetWraparoundString",value:function(){return this.wraparound?"  xyz = mod(xyz, texDim);\n":""}},{key:"_getGetTextureChannelString",value:function(){return this.floatTextures?this._linesToString(["  int channel = integerMod(index, 4)","  index = index / 4"]):""}},{key:"_getGetTextureIndexString",value:function(){return this.floatTextures?"  index = index / 4;\n":""}},{key:"_getGetResultString",value:function(){return this.floatTextures?this._linesToString(["  if (channel == 0) return texel.r","  if (channel == 1) return texel.g","  if (channel == 2) return texel.b","  if (channel == 3) return texel.a"]):"  return decode(texel, x, bitRatio);"}},{key:"_getMainArgumentsString",value:function(t){for(var e=[],n=this.argumentTypes,i=this.argumentNames,r=0;r<i.length;r++){var s=t[r],a=i[r],o=n[r];if(this.hardcodeConstants)if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o){var u=c.getDimensions(s,!0),h=c.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},u);e.push("uniform sampler2D user_"+a,"ivec2 user_"+a+"Size = ivec2("+h[0]+", "+h[1]+")","ivec3 user_"+a+"Dim = ivec3("+u[0]+", "+u[1]+", "+u[2]+")","uniform int user_"+a+"BitRatio")}else"Integer"===o?e.push("float user_"+a+" = "+s+".0"):"Float"===o&&e.push("float user_"+a+" = "+s);else if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o||"Input"===o||"HTMLImage"===o)e.push("uniform sampler2D user_"+a,"uniform ivec2 user_"+a+"Size","uniform ivec3 user_"+a+"Dim"),"HTMLImage"!==o&&e.push("uniform int user_"+a+"BitRatio");else{if("Integer"!==o&&"Float"!==o)throw new Error("Param type "+a+" not supported in WebGL, only WebGL2");e.push("uniform float user_"+a)}}return this._linesToString(e)}},{key:"_getMainConstantsString",value:function(){var t=[];if(this.constants)for(var e in this.constants)if(this.constants.hasOwnProperty(e)){var n=this.constants[e],i=c.getVariableType(n,!0);switch(i){case"Integer":t.push("const int constants_"+e+" = "+parseInt(n));break;case"Float":t.push("const float constants_"+e+" = "+parseFloat(n));break;case"Array":case"Input":case"HTMLImage":case"NumberTexture":case"ArrayTexture(4)":t.push("uniform sampler2D constants_"+e,"uniform ivec2 constants_"+e+"Size","uniform ivec3 constants_"+e+"Dim","uniform int constants_"+e+"BitRatio");break;default:throw new Error("Unsupported constant "+e+" type "+i)}}return this._linesToString(t)}},{key:"_getKernelString",value:function(){var t=[],e=this.subKernels;if(null!==e){t.push("float kernelResult = 0.0");for(var n=0;n<e.length;n++)t.push("float subKernelResult_"+e[n].name+" = 0.0")}else t.push("float kernelResult = 0.0");var i=u.fromKernel(this,h,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});return this._linesToString(t)+i.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var t=this.subKernels,e=[];if(this.floatOutput&&e.push("  index *= 4"),this.graphical)e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor");else if(this.floatOutput)for(var n=["r","g","b","a"],i=0;i<n.length;++i){if(e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),t){e.push("  gl_FragData[0]."+n[i]+" = kernelResult");for(var r=0;r<t.length;++r)e.push("  gl_FragData["+(r+1)+"]."+n[i]+" = subKernelResult_"+t[r].name)}else e.push("  gl_FragColor."+n[i]+" = kernelResult");i<n.length-1&&e.push("  index += 1")}else if(null!==t){e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),e.push("  gl_FragData[0] = encode32(kernelResult)");for(var s=0;s<t.length;s++)e.push("  gl_FragData["+(s+1)+"] = encode32(subKernelResult_"+t[s].name+")")}else e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = encode32(kernelResult)");return this._linesToString(e)}},{key:"_linesToString",value:function(t){return t.length>0?t.join(";\n")+";\n":"\n"}},{key:"_replaceArtifacts",value:function(t,e){return t.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z])*)__;\n/g,function(t,n){if(e.hasOwnProperty(n))return e[n];throw"unhandled artifact "+n})}},{key:"_getFragShaderString",value:function(t){return null!==this.compiledFragShaderString?this.compiledFragShaderString:this.compiledFragShaderString=this._replaceArtifacts(this.constructor.fragShaderString,this._getFragShaderArtifactMap(t))}},{key:"_getVertShaderString",value:function(t){return null!==this.compiledVertShaderString?this.compiledVertShaderString:this.compiledVertShaderString=this.constructor.vertShaderString}},{key:"toString",value:function(){return d(this)}},{key:"destroy",value:function(t){this.outputTexture&&this.context.deleteTexture(this.outputTexture),
this.buffer&&this.context.deleteBuffer(this.buffer),this.framebuffer&&this.context.deleteFramebuffer(this.framebuffer),this.vertShader&&this.context.deleteShader(this.vertShader),this.fragShader&&this.context.deleteShader(this.fragShader),this.program&&this.context.deleteProgram(this.program);for(var e=Object.keys(this.textureCache),n=0;n<e.length;n++){var i=e[n];this.context.deleteTexture(this.textureCache[i])}if(this.subKernelOutputTextures)for(var r=0;r<this.subKernelOutputTextures.length;r++)this.context.deleteTexture(this.subKernelOutputTextures[r]);if(t){var s=_.indexOf(this.canvas);s>=0&&(_[s]=null,E[s]=null)}this.destroyExtensions(),delete this.context,delete this.canvas}},{key:"destroyExtensions",value:function(){this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null}}],[{key:"destroyContext",value:function(t){var e=t.getExtension("WEBGL_lose_context");e&&e.loseContext()}}]),e}(o);e.exports=T},{"../../texture":23,"../../utils":24,"../function-builder":5,"../gl-kernel":7,"./function-node":10,"./kernel-string":11,"./shader-frag":13,"./shader-vert":14}],13:[function(t,e,n){e.exports="__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst int LOOP_MAX = __LOOP_MAX__;\n\n__CONSTANTS__;\n\nvarying vec2 vTexCoord;\n\nvec4 round(vec4 x) {\n  return floor(x + 0.5);\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x / y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nvec4 encode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nfloat decode(vec4 rgba, int x, int bitRatio) {\n  if (bitRatio == 1) {\n    return decode32(rgba);\n  }\n  __DECODE32_ENDIANNESS__;\n  int channel = integerMod(x, bitRatio);\n  if (bitRatio == 4) {\n    if (channel == 0) return rgba.r * 255.0;\n    if (channel == 1) return rgba.g * 255.0;\n    if (channel == 2) return rgba.b * 255.0;\n    if (channel == 3) return rgba.a * 255.0;\n  }\n  else {\n    if (channel == 0) return rgba.r * 255.0 + rgba.g * 65280.0;\n    if (channel == 1) return rgba.b * 255.0 + rgba.a * 65280.0;\n  }\n}\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  __GET_RESULT__;\n  \n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, float z, float y, float x) {\n  return get(tex, texSize, texDim, bitRatio, int(z), int(y), int(x));\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int y, int x) {\n  return get(tex, texSize, texDim, bitRatio, 0, y, x);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, float y, float x) {\n  return get(tex, texSize, texDim, bitRatio, 0, int(y), int(x));\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int x) {\n  return get(tex, texSize, texDim, bitRatio, 0, 0, x);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, float x) {\n  return get(tex, texSize, texDim, bitRatio, 0, 0, int(x));\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture2D(tex, st / vec2(texSize));\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int y, int x) {\n  return getImage2D(tex, texSize, texDim, 0, y, x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int x) {\n  return getImage2D(tex, texSize, texDim, 0, 0, x);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nvoid color(sampler2D image) {\n  actualColor = texture2D(image, vTexCoord);\n}\n\n__MAIN_CONSTANTS__;\n__MAIN_ARGUMENTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}"},{}],14:[function(t,e,n){e.exports="precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nattribute vec2 aPos;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"},{}],15:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){return t.replace(h,"((").replace(c,"((")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t("../web-gl/function-node"),h=/decode32\(\s+encode32\(/g,c=/encode32\(\s+decode32\(/g,l=function(t){function e(t,n){i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return s._string=null,s}return s(e,t),o(e,[{key:"toString",value:function(){return this.prototypeOnly?this.astFunctionPrototype(this.getJsAST(),[]).join("").trim():this._string?this._string:this._string=a(this.astGeneric(this.getJsAST(),[]).join("").trim())}},{key:"astIdentifierExpression",value:function(t,e){if("Identifier"!==t.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",t);var n=!this.isState("in-get-call-parameters");switch(t.name){case"gpu_threadX":n?e.push("float(threadId.x)"):e.push("threadId.x");break;case"gpu_threadY":n?e.push("float(threadId.y)"):e.push("threadId.y");break;case"gpu_threadZ":n?e.push("float(threadId.z)"):e.push("threadId.z");break;case"gpu_outputX":e.push("uOutputDim.x");break;case"gpu_outputY":e.push("uOutputDim.y");break;case"gpu_outputZ":e.push("uOutputDim.z");break;case"Infinity":e.push("intBitsToFloat(2139095039)");break;default:var i=this.getUserArgumentName(t.name);null!==i?this.pushParameter(e,i):this.pushParameter(e,t.name)}return e}}]),e}(u);e.exports=l},{"../web-gl/function-node":10}],16:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function E(t,e,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:E(r,e,n)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(n)},u=t("../web-gl/kernel"),h=t("./function-node"),c=t("../function-builder"),l=t("../../utils"),p=t("../../texture"),f=t("./shader-frag"),d=t("./shader-vert"),m=null,g=null,x=null,y=null,v=null,_=function(t){function e(){return i(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),a(e,[{key:"initContext",value:function(){var t={alpha:!1,depth:!1,antialias:!1},e=this.canvas.getContext("webgl2",t);return e}},{key:"initExtensions",value:function(){this.extensions={EXT_color_buffer_float:this.context.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear")}}},{key:"validateSettings",value:function(){if(this.skipValidateSettings)return void(this.texSize=l.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0));var t=this.constructor.features;if(this.floatOutput===!0&&this.floatOutputForce!==!0&&!t.isFloatRead)throw new Error("Float texture outputs are not supported");if(void 0===this.floatTextures&&(this.floatTextures=!0,this.floatOutput=t.isFloatRead),null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=!t.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&t.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var e=l.getVariableType(arguments[0]);if("Array"===e)this.output=l.getDimensions(e);else{if("NumberTexture"!==e&&"ArrayTexture(4)"!==e)throw new Error("Auto output not supported for input type: "+e);this.output=arguments[0].output}}if(this.texSize=l.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=l.clone(this.output)}else void 0===this.floatOutput&&(this.floatOutput=!0);(this.floatOutput||this.floatOutputForce)&&this.context.getExtension("EXT_color_buffer_float")}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var t=this.argumentNames,e=this.argumentTypes,n=this.texSize,i=this.context;i.useProgram(this.program),i.scissor(0,0,n[0],n[1]),this.hardcodeConstants||(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",n)),this.setUniform2f("ratio",n[0]/this.maxTexSize[0],n[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var r=0;r<t.length;r++)this._addArgument(arguments[r],e[r],t[r]);if(this.graphical)return this.outputToTexture?(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputTexture&&!this.outputImmutable||this._setupOutputTexture(),i.drawArrays(i.TRIANGLE_STRIP,0,4),new p(this.outputTexture,n,this.threadDim,this.output,this.context,"ArrayTexture(4)")):(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),void i.drawArrays(i.TRIANGLE_STRIP,0,4));i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputImmutable&&this._setupOutputTexture();var s=this.outputTexture;if(null!==this.subKernels&&(this.outputImmutable&&(this.subKernelOutputTextures=[],this._setupSubOutputTextures(this.subKernels.length)),i.drawBuffers(this.drawBuffersMap)),i.drawArrays(i.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures&&null!==this.subKernels){for(var a={result:this.renderOutput(s)},o=0;o<this.subKernels.length;o++)a[this.subKernels[o].property]=new p(this.subKernelOutputTextures[o],n,this.threadDim,this.output,this.context);return a}return this.renderOutput(s)}},{key:"drawBuffers",value:function(){this.context.drawBuffers(this.drawBuffersMap)}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var t=this.context,e=this.texSize,n=this.outputTexture=this.context.createTexture();t.activeTexture(t.TEXTURE0+this.constantsLength+this.argumentNames.length),t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,e[0],e[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}},{key:"_setupSubOutputTextures",value:function(t){for(var e=this.context,n=this.texSize,i=this.drawBuffersMap=[e.COLOR_ATTACHMENT0],r=this.subKernelOutputTextures=[],s=0;s<t;s++){var a=this.context.createTexture();r.push(a),i.push(e.COLOR_ATTACHMENT0+s+1),e.activeTexture(e.TEXTURE0+this.constantsLength+this.argumentNames.length+s),e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA32F,n[0],n[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n[0],n[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+s+1,e.TEXTURE_2D,a,0)}}},{key:"_addArgument",value:function(t,e,n){var i=this.context,r=this.getArgumentTexture(n);switch(t instanceof p&&(e=t.type),e){case"Array":var s=l.getDimensions(t,!0),a=l.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},s);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var o=a[0]*a[1],u=this._formatArrayTransfer(t,o),h=u.valuesFlat,c=u.bitRatio,f=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,a[0],a[1],0,i.RGBA,i.FLOAT,h):(f=new Uint8Array(h.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,a[0]/c,a[1],0,i.RGBA,i.UNSIGNED_BYTE,f)),this.hardcodeConstants||(this.setUniform3iv("user_"+n+"Dim",s),this.setUniform2iv("user_"+n+"Size",a)),this.setUniform1i("user_"+n+"BitRatio",c),this.setUniform1i("user_"+n,this.argumentsLength);break;case"Integer":case"Float":case"Number":this.setUniform1f("user_"+n,t);break;case"Input":var d=t,m=d.size,g=l.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},m);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var x=g[0]*g[1],y=this._formatArrayTransfer(t.value,x),v=y.valuesFlat,_=y.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,g[0],g[1],0,i.RGBA,i.FLOAT,inputArray);else{var E=new Uint8Array(v.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g[0]/_,g[1],0,i.RGBA,i.UNSIGNED_BYTE,E)}this.hardcodeConstants||(this.setUniform3iv("user_"+n+"Dim",m),this.setUniform2iv("user_"+n+"Size",g)),this.setUniform1i("user_"+n+"BitRatio",_),this.setUniform1i("user_"+n,this.argumentsLength);break;case"HTMLImage":var T=t,b=[T.width,T.height,1],S=[T.width,T.height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var k=0,A=i.RGBA,R=i.RGBA,w=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,k,A,R,w,T),this.setUniform3iv("user_"+n+"Dim",b),this.setUniform2iv("user_"+n+"Size",S),this.setUniform1i("user_"+n,this.argumentsLength);break;case"HTMLImageArray":var C=t,I=[C[0].width,C[0].height,C.length],D=[C[0].width,C[0].height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D_ARRAY,r),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MIN_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var O=0,N=i.RGBA,L=C[0].width,P=C[0].height,U=C.length,F=0,G=i.RGBA,M=i.UNSIGNED_BYTE;i.texImage3D(i.TEXTURE_2D_ARRAY,O,N,L,P,U,F,G,M,null);for(var B=0;B<C.length;B++){var z=0,j=0,X=1;i.texSubImage3D(i.TEXTURE_2D_ARRAY,O,z,j,B,C[B].width,C[B].height,X,G,M,C[B])}this.setUniform3iv("user_"+n+"Dim",I),this.setUniform2iv("user_"+n+"Size",D),this.setUniform1i("user_"+n,this.argumentsLength);break;case"ArrayTexture(4)":case"NumberTexture":var V=t;if(V.context!==this.context)throw new Error("argument "+n+" ("+e+") must be from same context");var K=V.dimensions,W=V.size;i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,V.texture),this.setUniform3iv("user_"+n+"Dim",K),this.setUniform2iv("user_"+n+"Size",W),this.setUniform1i("user_"+n+"BitRatio",1),this.setUniform1i("user_"+n,this.argumentsLength);break;default:throw new Error("Input type not supported: "+t)}this.argumentsLength++}},{key:"_getMainConstantsString",value:function(){var t=[];if(this.constants)for(var e in this.constants)if(this.constants.hasOwnProperty(e)){var n=this.constants[e],i=l.getVariableType(n,!0);switch(i){case"Integer":t.push("const int constants_"+e+" = "+parseInt(n));break;case"Float":t.push("const float constants_"+e+" = "+parseFloat(n));break;case"Array":case"Input":case"HTMLImage":case"ArrayTexture(4)":case"NumberTexture":t.push("uniform highp sampler2D constants_"+e,"uniform highp ivec2 constants_"+e+"Size","uniform highp ivec3 constants_"+e+"Dim","uniform highp int constants_"+e+"BitRatio");break;case"HTMLImageArray":t.push("uniform highp sampler2DArray constants_"+e,"uniform highp ivec2 constants_"+e+"Size","uniform highp ivec3 constants_"+e+"Dim","uniform highp int constants_"+e+"BitRatio");break;default:throw new Error("Unsupported constant "+e+" type "+i)}}return this._linesToString(t)}},{key:"_addConstant",value:function(t,e,n){var i=this.context,r=this.getArgumentTexture(n);switch(t instanceof p&&(e=t.type),e){case"Array":var s=l.getDimensions(t,!0),a=l.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},s);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var o=a[0]*a[1],u=this._formatArrayTransfer(t,o),h=u.valuesFlat,c=u.bitRatio,f=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,a[0],a[1],0,i.RGBA,i.FLOAT,h):(f=new Uint8Array(h.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,a[0]/c,a[1],0,i.RGBA,i.UNSIGNED_BYTE,f)),this.hardcodeConstants||(this.setUniform3iv("constants_"+n+"Dim",s),this.setUniform2iv("constants_"+n+"Size",a)),this.setUniform1i("constants_"+n+"BitRatio",c),this.setUniform1i("constants_"+n,this.constantsLength);break;case"Input":var d=t,m=d.size,g=l.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},m);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var x=g[0]*g[1],y=this._formatArrayTransfer(t.value,x),v=y.valuesFlat,_=y.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,g[0],g[1],0,i.RGBA,i.FLOAT,inputArray);else{var E=new Uint8Array(v.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g[0]/_,g[1],0,i.RGBA,i.UNSIGNED_BYTE,E)}this.hardcodeConstants||(this.setUniform3iv("constants_"+n+"Dim",m),this.setUniform2iv("constants_"+n+"Size",g)),this.setUniform1i("constants_"+n+"BitRatio",_),this.setUniform1i("constants_"+n,this.constantsLength);break;case"HTMLImage":var T=t,b=[T.width,T.height,1],S=[T.width,T.height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var k=0,A=i.RGBA,R=i.RGBA,w=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,k,A,R,w,T),this.setUniform3iv("constants_"+n+"Dim",b),this.setUniform2iv("constants_"+n+"Size",S),this.setUniform1i("constants_"+n,this.constantsLength);break;case"HTMLImageArray":var C=t,I=[C[0].width,C[0].height,C.length],D=[C[0].width,C[0].height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D_ARRAY,r),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MIN_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var O=0,N=i.RGBA,L=C[0].width,P=C[0].height,U=C.length,F=0,G=i.RGBA,M=i.UNSIGNED_BYTE;i.texImage3D(i.TEXTURE_2D_ARRAY,O,N,L,P,U,F,G,M,null);for(var B=0;B<C.length;B++){var z=0,j=0,X=1;i.texSubImage3D(i.TEXTURE_2D_ARRAY,O,z,j,B,C[B].width,C[B].height,X,G,M,C[B])}this.setUniform3iv("constants_"+n+"Dim",I),this.setUniform2iv("constants_"+n+"Size",D),this.setUniform1i("constants_"+n,this.constantsLength);break;case"ArrayTexture(4)":case"NumberTexture":var V=t;if(V.context!==this.context)throw new Error("argument "+n+" ("+e+") must be from same context");var K=V.dimensions,W=V.size;i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,V.texture),this.setUniform3iv("constants_"+n+"Dim",K),this.setUniform2iv("constants_"+n+"Size",W),this.setUniform1i("constants_"+n+"BitRatio",1),this.setUniform1i("constants_"+n,this.constantsLength);break;case"Integer":case"Float":default:throw new Error("Input type not supported: "+t)}this.constantsLength++}},{key:"_getGetResultString",value:function(){return this.floatTextures?"  return texel[channel];":"  return decode(texel, x, bitRatio);"}},{key:"_getHeaderString",value:function(){return""}},{key:"_getTextureCoordinate",value:function(){var t=this.subKernels;return null===t||t.length<1?"in highp vec2 vTexCoord;\n":"out highp vec2 vTexCoord;\n"}},{key:"_getMainArgumentsString",value:function(t){for(var e=[],n=this.argumentTypes,i=this.argumentNames,r=0;r<i.length;r++){var s=t[r],a=i[r],o=n[r];if(this.hardcodeConstants)if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o){var u=l.getDimensions(s,!0),h=l.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},u);e.push("uniform highp sampler2D user_"+a,"highp ivec2 user_"+a+"Size = ivec2("+h[0]+", "+h[1]+")","highp ivec3 user_"+a+"Dim = ivec3("+u[0]+", "+u[1]+", "+u[2]+")","uniform highp int user_"+a+"BitRatio")}else"Integer"===o?e.push("highp float user_"+a+" = "+s+".0"):"Float"===o&&e.push("highp float user_"+a+" = "+s);else"Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o||"Input"===o||"HTMLImage"===o?(e.push("uniform highp sampler2D user_"+a,"uniform highp ivec2 user_"+a+"Size","uniform highp ivec3 user_"+a+"Dim"),"HTMLImage"!==o&&e.push("uniform highp int user_"+a+"BitRatio")):"HTMLImageArray"===o?e.push("uniform highp sampler2DArray user_"+a,"uniform highp ivec2 user_"+a+"Size","uniform highp ivec3 user_"+a+"Dim"):"Integer"!==o&&"Float"!==o||e.push("uniform float user_"+a)}return this._linesToString(e)}},{key:"_getKernelString",value:function(){var t=[],e=this.subKernels;if(null!==e){t.push("float kernelResult = 0.0"),t.push("layout(location = 0) out vec4 data0");for(var n=0;n<e.length;n++)t.push("float subKernelResult_"+e[n].name+" = 0.0","layout(location = "+(n+1)+") out vec4 data"+(n+1))}else t.push("out vec4 data0"),t.push("float kernelResult = 0.0");var i=c.fromKernel(this,h,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});return this._linesToString(t)+i.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var t=this.subKernels,e=[];if(this.floatOutput&&e.push("  index *= 4"),this.graphical)e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor");else if(this.floatOutput)for(var n=["r","g","b","a"],i=0;i<n.length;++i){if(e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),t){e.push("  data0."+n[i]+" = kernelResult");for(var r=0;r<t.length;++r)e.push("  data"+(r+1)+"."+n[i]+" = subKernelResult_"+t[r].name)}else e.push("  data0."+n[i]+" = kernelResult");i<n.length-1&&e.push("  index += 1")}else if(null!==t){e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),e.push("  data0 = encode32(kernelResult)");for(var s=0;s<t.length;s++)e.push("  data"+(s+1)+" = encode32(subKernelResult_"+t[s].name+")")}else e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = encode32(kernelResult)");return this._linesToString(e)}},{key:"_getFragShaderString",value:function(t){return null!==this.compiledFragShaderString?this.compiledFragShaderString:this.compiledFragShaderString=this._replaceArtifacts(this.constructor.fragShaderString,this._getFragShaderArtifactMap(t))}},{key:"_getVertShaderString",value:function(t){return null!==this.compiledVertShaderString?this.compiledVertShaderString:this.compiledVertShaderString=this.constructor.vertShaderString}},{key:"destroyExtensions",value:function(){this.extensions.EXT_color_buffer_float=null,this.extensions.OES_texture_float_linear=null}}],[{key:"setupFeatureChecks",value:function(){"undefined"!=typeof document?g=document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas&&(g=new OffscreenCanvas(0,0)),g&&(x=g.getContext("webgl2"),y={EXT_color_buffer_float:x.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:x.getExtension("OES_texture_float_linear")},v=this.getFeatures())}},{key:"isContextMatch",value:function(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext}},{key:"getFeatures",value:function(){return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),kernelMap:!0})}},{key:"getIsIntegerDivisionAccurate",value:function(){return o(e.__proto__||Object.getPrototypeOf(e),"getIsIntegerDivisionAccurate",this).call(this)}},{key:"getMode",value:function(){return"gpu"}},{key:"isSupported",get:function(){return null!==m?m:(this.setupFeatureChecks(),m=this.isContextMatch(x))}},{key:"testCanvas",get:function(){return g}},{key:"testContext",get:function(){return x}},{key:"features",get:function(){return v}},{key:"fragShaderString",get:function(){return f}},{key:"vertShaderString",get:function(){return d}}]),e}(u);e.exports=_},{"../../texture":23,"../../utils":24,"../function-builder":5,"../web-gl/kernel":12,"./function-node":15,"./shader-frag":17,"./shader-vert":18}],17:[function(t,e,n){e.exports="#version 300 es\n__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst int LOOP_MAX = __LOOP_MAX__;\n\n__CONSTANTS__;\n\nin vec2 vTexCoord;\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x/y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nvec4 encode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nfloat decode(vec4 rgba, int x, int bitRatio) {\n  if (bitRatio == 1) {\n    return decode32(rgba);\n  }\n  __DECODE32_ENDIANNESS__;\n  int channel = integerMod(x, bitRatio);\n  if (bitRatio == 4) {\n    return rgba[channel] * 255.0;\n  }\n  else {\n    return rgba[channel*2] * 255.0 + rgba[channel*2 + 1] * 65280.0;\n  }\n}\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  __GET_RESULT__;\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, float z, float y, float x) {\n  return get(tex, texSize, texDim, bitRatio, int(z), int(y), int(x));\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture(tex, st / vec2(texSize));\n}\n\nvec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture(tex, vec3(st / vec2(texSize), z));\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int y, int x) {\n  return get(tex, texSize, texDim, bitRatio, 0, y, x);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, float y, float x) {\n  return get(tex, texSize, texDim, bitRatio, 0, int(y), int(x));\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int x) {\n  return get(tex, texSize, texDim, bitRatio, 0, 0, x);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, float x) {\n  return get(tex, texSize, texDim, bitRatio, int(x));\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int y, int x) {\n  return getImage2D(tex, texSize, texDim, 0, y, x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int x) {\n  return getImage2D(tex, texSize, texDim, 0, 0, x);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\n__MAIN_CONSTANTS__;\n__MAIN_ARGUMENTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}";
},{}],18:[function(t,e,n){e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nin vec2 aPos;\nin vec2 aTexCoord;\n\nout vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"},{}],19:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t("./utils"),o=t("./backend/cpu/kernel"),u=t("./backend/headless-gl/kernel"),h=t("./backend/web-gl2/kernel"),c=t("./backend/web-gl/kernel"),l=t("./kernel-run-shortcut"),p=[u,h,c],f=["gpu","cpu"],d={headlessgl:u,webgl2:h,webgl:c},m=function(){function t(e){if(i(this,t),e=e||{},this.canvas=e.canvas||null,this.context=e.context||null,this.mode=e.mode,this.Kernel=null,this.kernels=[],this.functions=[],this.nativeFunctions={},e.functions)for(var n=0;n<e.functions.length;n++)this.addFunction(e.functions[n]);this.chooseKernel()}return s(t,null,[{key:"kernelOrder",get:function(){return p}},{key:"kernelTypes",get:function(){return f}}]),s(t,[{key:"chooseKernel",value:function(){if(this.Kernel)return this.Kernel;var t=null;if(this.context){for(var e=0;e<p.length;e++){var n=p[e];if(n.isContextMatch(this.context)){t=n;break}}if(null===t)throw new Error("unknown Context")}else if(this.mode){if(this.mode in d)t=d[this.mode];else if("gpu"===this.mode){for(var i=0;i<p.length;i++)if(p[i].isSupported){t=p[i];break}}else"cpu"===this.mode&&(t=o);if(!t)throw new Error('A requested mode of "'+this.mode+'" and is not supported')}else{for(var r=0;r<p.length;r++)if(p[r].isSupported){t=p[r];break}t||(t=o)}return this.Kernel=t,t}},{key:"createKernel",value:function(t,e){if("undefined"==typeof t)throw"Missing source parameter";if(!a.isFunction(t)&&"string"!=typeof t)throw"source parameter not a function";var n=Object.assign({context:this.context,canvas:this.canvas,functions:this.functions,nativeFunctions:this.nativeFunctions},e||{});n.functions=n.functions.map(function(t){if("object"===("undefined"==typeof t?"undefined":r(t)))return t;var e=t.toString();return{source:e,settings:{name:a.getFunctionNameFromString(e)}}});var i=l(new this.Kernel(t.toString(),n));return this.canvas||(this.canvas=i.getCanvas()),this.context||(this.context=i.getContext()),this.kernels.push(i),i}},{key:"createKernelMap",value:function(){var t=void 0,e=void 0;if("function"==typeof arguments[arguments.length-2]?(t=arguments[arguments.length-2],e=arguments[arguments.length-1]):t=arguments[arguments.length-1],(!this.Kernel.isSupported||!this.Kernel.features.kernelMap)&&this.mode&&f.indexOf(this.mode)<0)throw new Error("kernelMap not supported on "+this.Kernel.name);var n=this.createKernel(t,e);if(Array.isArray(arguments[0]))for(var i=arguments[0],r=0;r<i.length;r++){var s=i[r].toString(),o=a.getFunctionNameFromString(s);n.addSubKernel({name:o,source:s,property:r})}else{var u=arguments[0];for(var h in u)if(u.hasOwnProperty(h)){var c=u[h].toString(),l=a.getFunctionNameFromString(c);n.addSubKernel({name:l||h,source:c,property:h})}}return n}},{key:"combineKernels",value:function(){var t=arguments[arguments.length-2],e=arguments[arguments.length-1];if("cpu"===this.getMode())return e;for(var n=arguments[0].getCanvas(),i=arguments[0].getContext(),r=0;r<arguments.length-1;r++)arguments[r].setCanvas(n).setContext(i).setOutputToTexture(!0);return function(){e.apply(null,arguments);var n=t.texSize,i=t.getContext(),r=t.threadDim,s=void 0;if(t.floatOutput){var o=n[0],u=Math.ceil(n[1]/4);s=new Float32Array(o*u*4),i.readPixels(0,0,o,u,i.RGBA,i.FLOAT,s)}else{var h=new Uint8Array(n[0]*n[1]*4);i.readPixels(0,0,n[0],n[1],i.RGBA,i.UNSIGNED_BYTE,h),s=new Float32Array(h.buffer)}if(s=s.subarray(0,r[0]*r[1]*r[2]),1===t.output.length)return s;if(2===t.output.length)return a.splitArray(s,t.output[0]);if(3===t.output.length){var c=a.splitArray(s,t.output[0]*t.output[1]);return c.map(function(e){return a.splitArray(e,t.output[0])})}}}},{key:"addFunction",value:function(t,e){if(this.kernels.length>0)throw new Error('Cannot call "addFunction" after "createKernels" has been called.');return this.functions.push({source:"string"==typeof t?t:t.toString(),settings:e}),this}},{key:"addNativeFunction",value:function(t,e){return this.nativeFunctions[t]=e,this}},{key:"getMode",value:function(){return this.mode||this.Kernel.getMode()}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getContext",value:function(){return this.context}},{key:"destroy",value:function(){var t=this;setTimeout(function(){for(var e=0;e<t.kernels.length;e++)t.kernels[e].destroy(!0);t.kernels[0].kernel.constructor.destroyContext(t.context)},0)}}],[{key:"isWebGLSupported",get:function(){return c.isSupported}},{key:"isWebGL2Supported",get:function(){return h.isSupported}},{key:"isHeadlessGLSupported",get:function(){return u.isSupported}},{key:"isCanvasSupported",get:function(){return"undefined"!=typeof HTMLCanvasElement}}]),t}();e.exports=m},{"./backend/cpu/kernel":4,"./backend/headless-gl/kernel":8,"./backend/web-gl/kernel":12,"./backend/web-gl2/kernel":16,"./kernel-run-shortcut":22,"./utils":24}],20:[function(t,e,n){var i=t("./gpu"),r=t("./alias"),s=t("./utils"),a=t("./input"),o=t("./texture"),u=t("./backend/function-builder"),h=t("./backend/cpu/function-node"),c=t("./backend/cpu/kernel"),l=t("./backend/headless-gl/kernel"),p=t("./backend/web-gl/function-node"),f=t("./backend/web-gl/kernel"),d=t("./backend/web-gl2/function-node"),m=t("./backend/web-gl2/kernel");i.alias=r,i.utils=s,i.FunctionBuilder=u,i.Texture=o,i.Input=a,i.input=function(t,e){return new a(t,e)},i.CPUFunctionNode=h,i.CPUKernel=c,i.HeadlessGLKernel=l,i.WebGLFunctionNode=p,i.WebGLKernel=f,i.WebGL2FunctionNode=d,i.WebGL2Kernel=m,"undefined"!=typeof e&&(e.exports=i),"undefined"!=typeof window&&(window.GPU=i),"undefined"!=typeof self&&(self.GPU=i)},{"./alias":1,"./backend/cpu/function-node":2,"./backend/cpu/kernel":4,"./backend/function-builder":5,"./backend/headless-gl/kernel":8,"./backend/web-gl/function-node":10,"./backend/web-gl/kernel":12,"./backend/web-gl2/function-node":15,"./backend/web-gl2/kernel":16,"./gpu":19,"./input":21,"./texture":23,"./utils":24}],21:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function s(t,e){if(i(this,s),this.value=t,Array.isArray(e)){this.size=[];for(var n=0;n<e.length;n++)this.size[n]=e[n];for(;this.size.length<3;)this.size.push(1)}else e.z?this.size=[e.x,e.y,e.z]:e.y?this.size=[e.x,e.y,1]:this.size=[e.x,1,1]};e.exports=r},{}],22:[function(t,e,n){var i=t("./utils");e.exports=function(t){var e=function(){return t.run.apply(t,arguments)};return i.allPropertiesOf(t).forEach(function(n){"_"===n[0]&&"_"===n[1]||("function"==typeof t[n]?"add"===n.substring(0,3)||"set"===n.substring(0,3)?e[n]=function(){return t[n].apply(t,arguments),e}:e[n]=t[n].bind(t):(e.__defineGetter__(n,function(){return t[n]}),e.__defineSetter__(n,function(e){t[n]=e})))}),e.kernel=t,e}},{"./utils":24}],23:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=function(){function t(e,n,r,s,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NumberTexture";i(this,t),this.texture=e,this.size=n,this.dimensions=r,this.output=s,this.context=a,this.kernel=null,this.type=o}return r(t,[{key:"toArray",value:function(t){if(!t)throw new Error("You need to pass the GPU object for toArray to work.");return this.kernel?this.kernel(this):(this.kernel=t.createKernel(function(t){return t[this.thread.z][this.thread.y][this.thread.x]}).setOutput(this.output),this.kernel(this))}},{key:"delete",value:function(){return this.context.deleteTexture(this.texture)}}]),t}();e.exports=s},{}],24:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t("./input"),o=t("./texture"),u=/function ([^(]*)/,h=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,c=/([^\s,]+)/g,l=function(){function t(){i(this,t)}return s(t,null,[{key:"systemEndianness",value:function(){return p}},{key:"getSystemEndianness",value:function(){var t=new ArrayBuffer(4),e=new Uint32Array(t),n=new Uint8Array(t);if(e[0]=3735928559,239===n[0])return"LE";if(222===n[0])return"BE";throw new Error("unknown endianness")}},{key:"isFunction",value:function(t){return"function"==typeof t}},{key:"isFunctionString",value:function(t){return"string"==typeof t&&"function"===t.slice(0,"function".length).toLowerCase()}},{key:"getFunctionNameFromString",value:function(t){return u.exec(t)[1].trim()}},{key:"getFunctionBodyFromString",value:function(t){return t.substring(t.indexOf("{")+1,t.lastIndexOf("}"))}},{key:"getArgumentNamesFromString",value:function(t){var e=t.replace(h,""),n=e.slice(e.indexOf("(")+1,e.indexOf(")")).match(c);return null===n&&(n=[]),n}},{key:"clone",value:function(e){if(null===e||"object"!==("undefined"==typeof e?"undefined":r(e))||e.hasOwnProperty("isActiveClone"))return e;var n=e.constructor();for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(e.isActiveClone=null,n[i]=t.clone(e[i]),delete e.isActiveClone);return n}},{key:"isArray",value:function(t){return!isNaN(t.length)}},{key:"getVariableType",value:function(e,n){return t.isArray(e)?"IMG"===e[0].nodeName?"HTMLImageArray":"Array":"number"==typeof e?n&&Number.isInteger(e)?"Integer":"Float":e instanceof o?e.type:e instanceof a?"Input":"IMG"===e.nodeName?"HTMLImage":"Unknown"}},{key:"dimToTexSize",value:function(t,e,n){for(var i=e[0],r=e[0],s=e[1],a=1;a<e.length;a++)i*=e[a];if(!t.floatTextures||n&&!t.floatOutput||(r=i=Math.ceil(i/4)),s>1&&r*s===i)return[r,s];for(var o=Math.sqrt(i),u=Math.ceil(o),h=Math.floor(o);u*h>i;)u--,h=Math.ceil(i/u);return r=h,s=Math.ceil(i/r),[r,s]}},{key:"getDimensions",value:function(e,n){var i=void 0;if(t.isArray(e)){for(var r=[],s=e;t.isArray(s);)r.push(s.length),s=s[0];i=r.reverse()}else if(e instanceof o)i=e.output;else{if(!(e instanceof a))throw new Error("Unknown dimensions of "+e);i=e.size}if(n)for(i=t.clone(i);i.length<3;)i.push(1);return new Int32Array(i)}},{key:"flatten2dArrayTo",value:function(t,e){for(var n=0,i=0;i<t.length;i++)e.set(t[i],n),n+=t[i].length}},{key:"flatten3dArrayTo",value:function(t,e){for(var n=0,i=0;i<t.length;i++)for(var r=0;r<t[i].length;r++)e.set(t[i][r],n),n+=t[i][r].length}},{key:"flattenTo",value:function(e,n){t.isArray(e[0])?t.isArray(e[0][0])?t.flatten3dArrayTo(e,n):t.flatten2dArrayTo(e,n):n.set(e)}},{key:"splitArray",value:function(t,e){for(var n=[],i=0;i<t.length;i+=e)n.push(new t.constructor(t.buffer,4*i+t.byteOffset,e));return n}},{key:"getAstString",value:function(t,e){var n=Array.isArray(t)?t:t.split(/\r?\n/g),i=e.loc.start,r=e.loc.end,s=[];s.push(n[i.line-1].slice(i.column));for(var a=i.line;a<r.line-1;a++)s.push(n[a]);return s.push(n[r.line-1].slice(0,r.column)),s.join("\n")}},{key:"allPropertiesOf",value:function(t){var e=[];do e.push.apply(e,Object.getOwnPropertyNames(t));while(t=Object.getPrototypeOf(t));return e}}]),t}(),p=l.getSystemEndianness();e.exports=l},{"./input":21,"./texture":23}],25:[function(t,e,n){!function(t,i){"object"==typeof n&&"undefined"!=typeof e?i(n):"function"==typeof define&&define.amd?define(["exports"],i):i(t.acorn={})}(this,function(t){function e(t,e){for(var n=65536,i=0;i<e.length;i+=2){if(n+=e[i],n>t)return!1;if(n+=e[i+1],n>=t)return!0}}function n(t,n){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&G.test(String.fromCharCode(t)):n!==!1&&e(t,B)))}function i(t,n){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&M.test(String.fromCharCode(t)):n!==!1&&(e(t,B)||e(t,z)))))}function r(t,e){return new j(t,{beforeExpr:!0,binop:e})}function s(t,e){return void 0===e&&(e={}),e.keyword=t,K[t]=new j(t,e)}function a(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}function o(t,e){return Z.call(t,e)}function u(t,e){for(var n=1,i=0;;){Y.lastIndex=i;var r=Y.exec(t);if(!(r&&r.index<e))return new et(n,e-i);++n,i=r.index+r[0].length}}function h(t){var e={};for(var n in it)e[n]=t&&o(t,n)?t[n]:it[n];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),tt(e.onToken)){var i=e.onToken;e.onToken=function(t){return i.push(t)}}return tt(e.onComment)&&(e.onComment=c(e,e.onComment)),e}function c(t,e){return function(n,i,r,s,a,o){var u={type:n?"Block":"Line",value:i,start:r,end:s};t.locations&&(u.loc=new nt(this,a,o)),t.ranges&&(u.range=[r,s]),e.push(u)}}function l(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}function p(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}function f(t,e,n,i){return t.type=e,t.end=n,this.options.locations&&(t.loc.end=i),this.options.ranges&&(t.range[1]=n),t}function d(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(1023&t)+56320))}function m(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function g(t){return n(t,!0)||36===t||95===t}function x(t){return i(t,!0)||36===t||95===t||8204===t||8205===t}function y(t){return t>=65&&t<=90||t>=97&&t<=122}function v(t){return t>=0&&t<=1114111}function _(t){return 100===t||68===t||115===t||83===t||119===t||87===t}function E(t){return y(t)||95===t}function T(t){return E(t)||b(t)}function b(t){return t>=48&&t<=57}function S(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function k(t){return t>=65&&t<=70?10+(t-65):t>=97&&t<=102?10+(t-97):t-48}function A(t){return t>=48&&t<=55}function R(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(1023&t)+56320))}function w(t,e){return new st(e,t).parse()}function C(t,e,n){var i=new st(n,t,e);return i.nextToken(),i.parseExpression()}function I(t,e){return new st(e,t)}function D(e,n,i){t.parse_dammit=e,t.LooseParser=n,t.pluginsLoose=i}var O={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},N="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",L={5:N,6:N+" const class extends export import super"},P=/^in(stanceof)?$/,U="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿯ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞹꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",F="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ංඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ູົຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭ᳲ-᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",G=new RegExp("["+U+"]"),M=new RegExp("["+U+F+"]");U=F=null;var B=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,190,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,26,230,43,117,63,32,0,257,0,11,39,8,0,22,0,12,39,3,3,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,68,12,0,67,12,65,1,31,6129,15,754,9486,286,82,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],z=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,280,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239],j=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null},X={beforeExpr:!0},V={startsExpr:!0},K={},W={num:new j("num",V),regexp:new j("regexp",V),string:new j("string",V),name:new j("name",V),eof:new j("eof"),bracketL:new j("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new j("]"),braceL:new j("{",{beforeExpr:!0,startsExpr:!0}),braceR:new j("}"),parenL:new j("(",{beforeExpr:!0,startsExpr:!0}),parenR:new j(")"),comma:new j(",",X),semi:new j(";",X),colon:new j(":",X),dot:new j("."),question:new j("?",X),arrow:new j("=>",X),template:new j("template"),invalidTemplate:new j("invalidTemplate"),ellipsis:new j("...",X),backQuote:new j("`",V),dollarBraceL:new j("${",{beforeExpr:!0,startsExpr:!0}),eq:new j("=",{beforeExpr:!0,isAssign:!0}),assign:new j("_=",{beforeExpr:!0,isAssign:!0}),incDec:new j("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new j("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:r("||",1),logicalAND:r("&&",2),bitwiseOR:r("|",3),bitwiseXOR:r("^",4),bitwiseAND:r("&",5),equality:r("==/!=/===/!==",6),relational:r("</>/<=/>=",7),bitShift:r("<</>>/>>>",8),plusMin:new j("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:r("%",10),star:r("*",10),slash:r("/",10),starstar:new j("**",{beforeExpr:!0}),_break:s("break"),_case:s("case",X),_catch:s("catch"),_continue:s("continue"),_debugger:s("debugger"),_default:s("default",X),_do:s("do",{isLoop:!0,beforeExpr:!0}),_else:s("else",X),_finally:s("finally"),_for:s("for",{isLoop:!0}),_function:s("function",V),_if:s("if"),_return:s("return",X),_switch:s("switch"),_throw:s("throw",X),_try:s("try"),_var:s("var"),_const:s("const"),_while:s("while",{isLoop:!0}),_with:s("with"),_new:s("new",{beforeExpr:!0,startsExpr:!0}),_this:s("this",V),_super:s("super",V),_class:s("class",V),_extends:s("extends",X),_export:s("export"),_import:s("import"),_null:s("null",V),_true:s("true",V),_false:s("false",V),_in:s("in",{beforeExpr:!0,binop:7}),_instanceof:s("instanceof",{beforeExpr:!0,binop:7}),_typeof:s("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:s("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:s("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},H=/\r\n?|\n|\u2028|\u2029/,Y=new RegExp(H.source,"g"),q=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Q=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,J=Object.prototype,Z=J.hasOwnProperty,$=J.toString,tt=Array.isArray||function(t){return"[object Array]"===$.call(t)},et=function(t,e){this.line=t,this.column=e};et.prototype.offset=function(t){return new et(this.line,this.column+t)};var nt=function(t,e,n){this.start=e,this.end=n,null!==t.sourceFile&&(this.source=t.sourceFile)},it={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}},rt={},st=function(t,e,n){this.options=t=h(t),this.sourceFile=t.sourceFile,this.keywords=l(L[t.ecmaVersion>=6?6:5]);var i="";if(!t.allowReserved){for(var r=t.ecmaVersion;!(i=O[r]);r--);"module"===t.sourceType&&(i+=" await")}this.reservedWords=l(i);var s=(i?i+" ":"")+O.strict;this.reservedWordsStrict=l(s),this.reservedWordsStrictBind=l(s+" "+O.strictBind),this.input=String(e),this.containsEsc=!1,this.loadPlugins(t.plugins),n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(H).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=W.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope(),this.regexpState=null};st.prototype.isKeyword=function(t){return this.keywords.test(t)},st.prototype.isReservedWord=function(t){return this.reservedWords.test(t)},st.prototype.extend=function(t,e){this[t]=e(this[t])},st.prototype.loadPlugins=function(t){var e=this;for(var n in t){var i=rt[n];if(!i)throw new Error("Plugin '"+n+"' not found");i(e,t[n])}},st.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)};var at=st.prototype,ot=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;at.strictDirective=function(t){for(var e=this;;){Q.lastIndex=t,t+=Q.exec(e.input)[0].length;var n=ot.exec(e.input.slice(t));if(!n)return!1;if("use strict"===(n[1]||n[2]))return!0;t+=n[0].length}},at.eat=function(t){return this.type===t&&(this.next(),!0)},at.isContextual=function(t){return this.type===W.name&&this.value===t&&!this.containsEsc},at.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},at.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},at.canInsertSemicolon=function(){return this.type===W.eof||this.type===W.braceR||H.test(this.input.slice(this.lastTokEnd,this.start))},at.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},at.semicolon=function(){this.eat(W.semi)||this.insertSemicolon()||this.unexpected()},at.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},at.expect=function(t){this.eat(t)||this.unexpected()},at.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},at.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var n=e?t.parenthesizedAssign:t.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},at.checkExpressionErrors=function(t,e){if(!t)return!1;var n=t.shorthandAssign,i=t.doubleProto;return e?(n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),void(i>=0&&this.raiseRecoverable(i,"Redefinition of __proto__ property"))):n>=0||i>=0},at.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},at.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var ut=st.prototype;ut.parseTopLevel=function(t){var e=this,n={};for(t.body||(t.body=[]);this.type!==W.eof;){var i=e.parseStatement(!0,!0,n);t.body.push(i)}return this.adaptDirectivePrologue(t.body),this.next(),this.options.ecmaVersion>=6&&(t.sourceType=this.options.sourceType),this.finishNode(t,"Program")};var ht={kind:"loop"},ct={kind:"switch"};ut.isLet=function(){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Q.lastIndex=this.pos;var t=Q.exec(this.input),e=this.pos+t[0].length,r=this.input.charCodeAt(e);if(91===r||123===r)return!0;if(n(r,!0)){for(var s=e+1;i(this.input.charCodeAt(s),!0);)++s;var a=this.input.slice(e,s);if(!P.test(a))return!0}return!1},ut.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Q.lastIndex=this.pos;var t=Q.exec(this.input),e=this.pos+t[0].length;return!(H.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&i(this.input.charAt(e+8)))},ut.parseStatement=function(t,e,n){var i,r=this.type,s=this.startNode();switch(this.isLet()&&(r=W._var,i="let"),r){case W._break:case W._continue:return this.parseBreakContinueStatement(s,r.keyword);case W._debugger:return this.parseDebuggerStatement(s);case W._do:return this.parseDoStatement(s);case W._for:return this.parseForStatement(s);case W._function:return!t&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1);case W._class:return t||this.unexpected(),this.parseClass(s,!0);case W._if:return this.parseIfStatement(s);case W._return:return this.parseReturnStatement(s);case W._switch:return this.parseSwitchStatement(s);case W._throw:return this.parseThrowStatement(s);case W._try:return this.parseTryStatement(s);case W._const:case W._var:return i=i||this.value,t||"var"===i||this.unexpected(),this.parseVarStatement(s,i);case W._while:return this.parseWhileStatement(s);case W._with:return this.parseWithStatement(s);case W.braceL:return this.parseBlock();case W.semi:return this.parseEmptyStatement(s);case W._export:case W._import:return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),r===W._import?this.parseImport(s):this.parseExport(s,n);default:if(this.isAsyncFunction())return t||this.unexpected(),this.next(),this.parseFunctionStatement(s,!0);var a=this.value,o=this.parseExpression();return r===W.name&&"Identifier"===o.type&&this.eat(W.colon)?this.parseLabeledStatement(s,a,o):this.parseExpressionStatement(s,o)}},ut.parseBreakContinueStatement=function(t,e){var n=this,i="break"===e;this.next(),this.eat(W.semi)||this.insertSemicolon()?t.label=null:this.type!==W.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var s=n.labels[r];if(null==t.label||s.name===t.label.name){if(null!=s.kind&&(i||"loop"===s.kind))break;if(t.label&&i)break}}return r===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,i?"BreakStatement":"ContinueStatement")},ut.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},ut.parseDoStatement=function(t){return this.next(),this.labels.push(ht),t.body=this.parseStatement(!1),this.labels.pop(),this.expect(W._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(W.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},ut.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&this.inAsync&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(ht),this.enterLexicalScope(),this.expect(W.parenL),this.type===W.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var n=this.isLet();if(this.type===W._var||this.type===W._const||n){var i=this.startNode(),r=n?"let":this.value;return this.next(),this.parseVar(i,!0,r),this.finishNode(i,"VariableDeclaration"),!(this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==i.declarations.length||"var"!==r&&i.declarations[0].init?(e>-1&&this.unexpected(e),this.parseFor(t,i)):(this.options.ecmaVersion>=9&&(this.type===W._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,i))}var s=new p,a=this.parseExpression(!0,s);return this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===W._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(a,!1,s),this.checkLVal(a),this.parseForIn(t,a)):(this.checkExpressionErrors(s,!0),e>-1&&this.unexpected(e),this.parseFor(t,a))},ut.parseFunctionStatement=function(t,e){return this.next(),this.parseFunction(t,!0,!1,e)},ut.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement(!this.strict&&this.type===W._function),t.alternate=this.eat(W._else)?this.parseStatement(!this.strict&&this.type===W._function):null,this.finishNode(t,"IfStatement")},ut.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(W.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},ut.parseSwitchStatement=function(t){var e=this;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(W.braceL),this.labels.push(ct),this.enterLexicalScope();for(var n,i=!1;this.type!==W.braceR;)if(e.type===W._case||e.type===W._default){var r=e.type===W._case;n&&e.finishNode(n,"SwitchCase"),t.cases.push(n=e.startNode()),n.consequent=[],e.next(),r?n.test=e.parseExpression():(i&&e.raiseRecoverable(e.lastTokStart,"Multiple default clauses"),i=!0,n.test=null),e.expect(W.colon)}else n||e.unexpected(),n.consequent.push(e.parseStatement(!0));return this.exitLexicalScope(),n&&this.finishNode(n,"SwitchCase"),this.next(),
this.labels.pop(),this.finishNode(t,"SwitchStatement")},ut.parseThrowStatement=function(t){return this.next(),H.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var lt=[];ut.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===W._catch){var e=this.startNode();this.next(),this.eat(W.parenL)?(e.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(e.param,"let"),this.expect(W.parenR)):(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterLexicalScope()),e.body=this.parseBlock(!1),this.exitLexicalScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(W._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},ut.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},ut.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(ht),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,"WhileStatement")},ut.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement(!1),this.finishNode(t,"WithStatement")},ut.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},ut.parseLabeledStatement=function(t,e,n){for(var i=this,r=0,s=i.labels;r<s.length;r+=1){var a=s[r];a.name===e&&i.raise(n.start,"Label '"+e+"' is already declared")}for(var o=this.type.isLoop?"loop":this.type===W._switch?"switch":null,u=this.labels.length-1;u>=0;u--){var h=i.labels[u];if(h.statementStart!==t.start)break;h.statementStart=i.start,h.kind=o}return this.labels.push({name:e,kind:o,statementStart:this.start}),t.body=this.parseStatement(!0),("ClassDeclaration"===t.body.type||"VariableDeclaration"===t.body.type&&"var"!==t.body.kind||"FunctionDeclaration"===t.body.type&&(this.strict||t.body.generator))&&this.raiseRecoverable(t.body.start,"Invalid labeled declaration"),this.labels.pop(),t.label=n,this.finishNode(t,"LabeledStatement")},ut.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},ut.parseBlock=function(t){var e=this;void 0===t&&(t=!0);var n=this.startNode();for(n.body=[],this.expect(W.braceL),t&&this.enterLexicalScope();!this.eat(W.braceR);){var i=e.parseStatement(!0);n.body.push(i)}return t&&this.exitLexicalScope(),this.finishNode(n,"BlockStatement")},ut.parseFor=function(t,e){return t.init=e,this.expect(W.semi),t.test=this.type===W.semi?null:this.parseExpression(),this.expect(W.semi),t.update=this.type===W.parenR?null:this.parseExpression(),this.expect(W.parenR),this.exitLexicalScope(),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,"ForStatement")},ut.parseForIn=function(t,e){var n=this.type===W._in?"ForInStatement":"ForOfStatement";return this.next(),"ForInStatement"===n&&("AssignmentPattern"===e.type||"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(this.strict||"Identifier"!==e.declarations[0].id.type))&&this.raise(e.start,"Invalid assignment in for-in loop head"),t.left=e,t.right="ForInStatement"===n?this.parseExpression():this.parseMaybeAssign(),this.expect(W.parenR),this.exitLexicalScope(),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,n)},ut.parseVar=function(t,e,n){var i=this;for(t.declarations=[],t.kind=n;;){var r=i.startNode();if(i.parseVarId(r,n),i.eat(W.eq)?r.init=i.parseMaybeAssign(e):"const"!==n||i.type===W._in||i.options.ecmaVersion>=6&&i.isContextual("of")?"Identifier"===r.id.type||e&&(i.type===W._in||i.isContextual("of"))?r.init=null:i.raise(i.lastTokEnd,"Complex binding patterns require an initialization value"):i.unexpected(),t.declarations.push(i.finishNode(r,"VariableDeclarator")),!i.eat(W.comma))break}return t},ut.parseVarId=function(t,e){t.id=this.parseBindingAtom(e),this.checkLVal(t.id,e,!1)},ut.parseFunction=function(t,e,n,i){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(t.generator=this.eat(W.star)),this.options.ecmaVersion>=8&&(t.async=!!i),e&&(t.id="nullableID"===e&&this.type!==W.name?null:this.parseIdent(),t.id&&this.checkLVal(t.id,"var"));var r=this.inGenerator,s=this.inAsync,a=this.yieldPos,o=this.awaitPos,u=this.inFunction;return this.inGenerator=t.generator,this.inAsync=t.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),e||(t.id=this.type===W.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,n),this.inGenerator=r,this.inAsync=s,this.yieldPos=a,this.awaitPos=o,this.inFunction=u,this.finishNode(t,e?"FunctionDeclaration":"FunctionExpression")},ut.parseFunctionParams=function(t){this.expect(W.parenL),t.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ut.parseClass=function(t,e){var n=this;this.next(),this.parseClassId(t,e),this.parseClassSuper(t);var i=this.startNode(),r=!1;for(i.body=[],this.expect(W.braceL);!this.eat(W.braceR);){var s=n.parseClassMember(i);s&&"MethodDefinition"===s.type&&"constructor"===s.kind&&(r&&n.raise(s.start,"Duplicate constructor in the same class"),r=!0)}return t.body=this.finishNode(i,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},ut.parseClassMember=function(t){var e=this;if(this.eat(W.semi))return null;var n=this.startNode(),i=function(t,i){void 0===i&&(i=!1);var r=e.start,s=e.startLoc;return!!e.eatContextual(t)&&(!(e.type===W.parenL||i&&e.canInsertSemicolon())||(n.key&&e.unexpected(),n.computed=!1,n.key=e.startNodeAt(r,s),n.key.name=t,e.finishNode(n.key,"Identifier"),!1))};n.kind="method",n["static"]=i("static");var r=this.eat(W.star),s=!1;r||(this.options.ecmaVersion>=8&&i("async",!0)?(s=!0,r=this.options.ecmaVersion>=9&&this.eat(W.star)):i("get")?n.kind="get":i("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key;return n.computed||n["static"]||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n["static"]&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),r&&this.raise(a.start,"Constructor can't be a generator"),s&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor"),this.parseClassMethod(t,n,r,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},ut.parseClassMethod=function(t,e,n,i){e.value=this.parseMethod(n,i),t.body.push(this.finishNode(e,"MethodDefinition"))},ut.parseClassId=function(t,e){t.id=this.type===W.name?this.parseIdent():e===!0?this.unexpected():null},ut.parseClassSuper=function(t){t.superClass=this.eat(W._extends)?this.parseExprSubscripts():null},ut.parseExport=function(t,e){var n=this;if(this.next(),this.eat(W.star))return this.expectContextual("from"),this.type!==W.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(W._default)){this.checkExport(e,"default",this.lastTokStart);var i;if(this.type===W._function||(i=this.isAsyncFunction())){var r=this.startNode();this.next(),i&&this.next(),t.declaration=this.parseFunction(r,"nullableID",!1,i)}else if(this.type===W._class){var s=this.startNode();t.declaration=this.parseClass(s,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(!0),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==W.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var a=0,o=t.specifiers;a<o.length;a+=1){var u=o[a];n.checkUnreserved(u.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},ut.checkExport=function(t,e,n){t&&(o(t,e)&&this.raiseRecoverable(n,"Duplicate export '"+e+"'"),t[e]=!0)},ut.checkPatternExport=function(t,e){var n=this,i=e.type;if("Identifier"===i)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===i)for(var r=0,s=e.properties;r<s.length;r+=1){var a=s[r];n.checkPatternExport(t,a)}else if("ArrayPattern"===i)for(var o=0,u=e.elements;o<u.length;o+=1){var h=u[o];h&&n.checkPatternExport(t,h)}else"Property"===i?this.checkPatternExport(t,e.value):"AssignmentPattern"===i?this.checkPatternExport(t,e.left):"RestElement"===i?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===i&&this.checkPatternExport(t,e.expression)},ut.checkVariableExport=function(t,e){var n=this;if(t)for(var i=0,r=e;i<r.length;i+=1){var s=r[i];n.checkPatternExport(t,s.id)}},ut.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},ut.parseExportSpecifiers=function(t){var e=this,n=[],i=!0;for(this.expect(W.braceL);!this.eat(W.braceR);){if(i)i=!1;else if(e.expect(W.comma),e.afterTrailingComma(W.braceR))break;var r=e.startNode();r.local=e.parseIdent(!0),r.exported=e.eatContextual("as")?e.parseIdent(!0):r.local,e.checkExport(t,r.exported.name,r.exported.start),n.push(e.finishNode(r,"ExportSpecifier"))}return n},ut.parseImport=function(t){return this.next(),this.type===W.string?(t.specifiers=lt,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===W.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},ut.parseImportSpecifiers=function(){var t=this,e=[],n=!0;if(this.type===W.name){var i=this.startNode();if(i.local=this.parseIdent(),this.checkLVal(i.local,"let"),e.push(this.finishNode(i,"ImportDefaultSpecifier")),!this.eat(W.comma))return e}if(this.type===W.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,"let"),e.push(this.finishNode(r,"ImportNamespaceSpecifier")),e}for(this.expect(W.braceL);!this.eat(W.braceR);){if(n)n=!1;else if(t.expect(W.comma),t.afterTrailingComma(W.braceR))break;var s=t.startNode();s.imported=t.parseIdent(!0),t.eatContextual("as")?s.local=t.parseIdent():(t.checkUnreserved(s.imported),s.local=s.imported),t.checkLVal(s.local,"let"),e.push(t.finishNode(s,"ImportSpecifier"))}return e},ut.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},ut.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var pt=st.prototype;pt.toAssignable=function(t,e,n){var i=this;if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,s=t.properties;r<s.length;r+=1){var a=s[r];i.toAssignable(a,e),"RestElement"!==a.type||"ArrayPattern"!==a.argument.type&&"ObjectPattern"!==a.argument.type||i.raise(a.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e);break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return t},pt.toAssignableList=function(t,e){for(var n=this,i=t.length,r=0;r<i;r++){var s=t[r];s&&n.toAssignable(s,e)}if(i){var a=t[i-1];6===this.options.ecmaVersion&&e&&a&&"RestElement"===a.type&&"Identifier"!==a.argument.type&&this.unexpected(a.argument.start)}return t},pt.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},pt.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==W.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},pt.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case W.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(W.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case W.braceL:return this.parseObj(!0)}return this.parseIdent()},pt.parseBindingList=function(t,e,n){for(var i=this,r=[],s=!0;!this.eat(t);)if(s?s=!1:i.expect(W.comma),e&&i.type===W.comma)r.push(null);else{if(n&&i.afterTrailingComma(t))break;if(i.type===W.ellipsis){var a=i.parseRestBinding();i.parseBindingListItem(a),r.push(a),i.type===W.comma&&i.raise(i.start,"Comma is not permitted after the rest element"),i.expect(t);break}var o=i.parseMaybeDefault(i.start,i.startLoc);i.parseBindingListItem(o),r.push(o)}return r},pt.parseBindingListItem=function(t){return t},pt.parseMaybeDefault=function(t,e,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(W.eq))return n;var i=this.startNodeAt(t,e);return i.left=n,i.right=this.parseMaybeAssign(),this.finishNode(i,"AssignmentPattern")},pt.checkLVal=function(t,e,n){var i=this;switch(t.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),n&&(o(n,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),n[t.name]=!0),e&&"none"!==e&&(("var"===e&&!this.canDeclareVarName(t.name)||"var"!==e&&!this.canDeclareLexicalName(t.name))&&this.raiseRecoverable(t.start,"Identifier '"+t.name+"' has already been declared"),"var"===e?this.declareVarName(t.name):this.declareLexicalName(t.name));break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,s=t.properties;r<s.length;r+=1){var a=s[r];i.checkLVal(a,e,n)}break;case"Property":this.checkLVal(t.value,e,n);break;case"ArrayPattern":for(var u=0,h=t.elements;u<h.length;u+=1){var c=h[u];c&&i.checkLVal(c,e,n)}break;case"AssignmentPattern":this.checkLVal(t.left,e,n);break;case"RestElement":this.checkLVal(t.argument,e,n);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,n);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var ft=st.prototype;ft.checkPropClash=function(t,e,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var i,r=t.key;switch(r.type){case"Identifier":i=r.name;break;case"Literal":i=String(r.value);break;default:return}var s=t.kind;if(this.options.ecmaVersion>=6)return void("__proto__"===i&&"init"===s&&(e.proto&&(n&&n.doubleProto<0?n.doubleProto=r.start:this.raiseRecoverable(r.start,"Redefinition of __proto__ property")),e.proto=!0));i="$"+i;var a=e[i];if(a){var o;o="init"===s?this.strict&&a.init||a.get||a.set:a.init||a[s],o&&this.raiseRecoverable(r.start,"Redefinition of property")}else a=e[i]={init:!1,get:!1,set:!1};a[s]=!0}},ft.parseExpression=function(t,e){var n=this,i=this.start,r=this.startLoc,s=this.parseMaybeAssign(t,e);if(this.type===W.comma){var a=this.startNodeAt(i,r);for(a.expressions=[s];this.eat(W.comma);)a.expressions.push(n.parseMaybeAssign(t,e));return this.finishNode(a,"SequenceExpression")}return s},ft.parseMaybeAssign=function(t,e,n){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var i=!1,r=-1,s=-1;e?(r=e.parenthesizedAssign,s=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new p,i=!0);var a=this.start,o=this.startLoc;this.type!==W.parenL&&this.type!==W.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(t,e);if(n&&(u=n.call(this,u,a,o)),this.type.isAssign){var h=this.startNodeAt(a,o);return h.operator=this.value,h.left=this.type===W.eq?this.toAssignable(u,!1,e):u,i||p.call(e),e.shorthandAssign=-1,this.checkLVal(u),this.next(),h.right=this.parseMaybeAssign(t),this.finishNode(h,"AssignmentExpression")}return i&&this.checkExpressionErrors(e,!0),r>-1&&(e.parenthesizedAssign=r),s>-1&&(e.trailingComma=s),u},ft.parseMaybeConditional=function(t,e){var n=this.start,i=this.startLoc,r=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return r;if(this.eat(W.question)){var s=this.startNodeAt(n,i);return s.test=r,s.consequent=this.parseMaybeAssign(),this.expect(W.colon),s.alternate=this.parseMaybeAssign(t),this.finishNode(s,"ConditionalExpression")}return r},ft.parseExprOps=function(t,e){var n=this.start,i=this.startLoc,r=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)?r:r.start===n&&"ArrowFunctionExpression"===r.type?r:this.parseExprOp(r,n,i,-1,t)},ft.parseExprOp=function(t,e,n,i,r){var s=this.type.binop;if(null!=s&&(!r||this.type!==W._in)&&s>i){var a=this.type===W.logicalOR||this.type===W.logicalAND,o=this.value;this.next();var u=this.start,h=this.startLoc,c=this.parseExprOp(this.parseMaybeUnary(null,!1),u,h,s,r),l=this.buildBinary(e,n,t,c,o,a);return this.parseExprOp(l,e,n,i,r)}return t},ft.buildBinary=function(t,e,n,i,r,s){var a=this.startNodeAt(t,e);return a.left=n,a.operator=r,a.right=i,this.finishNode(a,s?"LogicalExpression":"BinaryExpression")},ft.parseMaybeUnary=function(t,e){var n,i=this,r=this.start,s=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),e=!0;else if(this.type.prefix){var a=this.startNode(),o=this.type===W.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),o?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):e=!0,n=this.finishNode(a,o?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var u=i.startNodeAt(r,s);u.operator=i.value,u.prefix=!1,u.argument=n,i.checkLVal(n),i.next(),n=i.finishNode(u,"UpdateExpression")}}return!e&&this.eat(W.starstar)?this.buildBinary(r,s,n,this.parseMaybeUnary(null,!1),"**",!1):n},ft.parseExprSubscripts=function(t){var e=this.start,n=this.startLoc,i=this.parseExprAtom(t),r="ArrowFunctionExpression"===i.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(t)||r)return i;var s=this.parseSubscripts(i,e,n);return t&&"MemberExpression"===s.type&&(t.parenthesizedAssign>=s.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=s.start&&(t.parenthesizedBind=-1)),s},ft.parseSubscripts=function(t,e,n,i){for(var r=this,s=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&"async"===this.input.slice(t.start,t.end),a=void 0;;)if((a=r.eat(W.bracketL))||r.eat(W.dot)){var o=r.startNodeAt(e,n);o.object=t,o.property=a?r.parseExpression():r.parseIdent(!0),o.computed=!!a,a&&r.expect(W.bracketR),t=r.finishNode(o,"MemberExpression")}else if(!i&&r.eat(W.parenL)){var u=new p,h=r.yieldPos,c=r.awaitPos;r.yieldPos=0,r.awaitPos=0;var l=r.parseExprList(W.parenR,r.options.ecmaVersion>=8,!1,u);if(s&&!r.canInsertSemicolon()&&r.eat(W.arrow))return r.checkPatternErrors(u,!1),r.checkYieldAwaitInDefaultParams(),r.yieldPos=h,r.awaitPos=c,r.parseArrowExpression(r.startNodeAt(e,n),l,!0);r.checkExpressionErrors(u,!0),r.yieldPos=h||r.yieldPos,r.awaitPos=c||r.awaitPos;var f=r.startNodeAt(e,n);f.callee=t,f.arguments=l,t=r.finishNode(f,"CallExpression")}else{if(r.type!==W.backQuote)return t;var d=r.startNodeAt(e,n);d.tag=t,d.quasi=r.parseTemplate({isTagged:!0}),t=r.finishNode(d,"TaggedTemplateExpression")}},ft.parseExprAtom=function(t){var e,n=this.potentialArrowAt===this.start;switch(this.type){case W._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),e=this.startNode(),this.next(),this.type!==W.dot&&this.type!==W.bracketL&&this.type!==W.parenL&&this.unexpected(),this.finishNode(e,"Super");case W._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case W.name:var i=this.start,r=this.startLoc,s=this.containsEsc,a=this.parseIdent(this.type!==W.name);if(this.options.ecmaVersion>=8&&!s&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(W._function))return this.parseFunction(this.startNodeAt(i,r),!1,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(W.arrow))return this.parseArrowExpression(this.startNodeAt(i,r),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===W.name&&!s)return a=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(W.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(i,r),[a],!0)}return a;case W.regexp:var o=this.value;return e=this.parseLiteral(o.value),e.regex={pattern:o.pattern,flags:o.flags},e;case W.num:case W.string:return this.parseLiteral(this.value);case W._null:case W._true:case W._false:return e=this.startNode(),e.value=this.type===W._null?null:this.type===W._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case W.parenL:var u=this.start,h=this.parseParenAndDistinguishExpression(n);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(h)&&(t.parenthesizedAssign=u),t.parenthesizedBind<0&&(t.parenthesizedBind=u)),h;case W.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(W.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case W.braceL:return this.parseObj(!1,t);case W._function:return e=this.startNode(),this.next(),this.parseFunction(e,!1);case W._class:return this.parseClass(this.startNode(),!1);case W._new:return this.parseNew();case W.backQuote:return this.parseTemplate();default:this.unexpected()}},ft.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(e,"Literal")},ft.parseParenExpression=function(){this.expect(W.parenL);var t=this.parseExpression();return this.expect(W.parenR),t},ft.parseParenAndDistinguishExpression=function(t){var e,n=this,i=this.start,r=this.startLoc,s=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,o=this.start,u=this.startLoc,h=[],c=!0,l=!1,f=new p,d=this.yieldPos,m=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==W.parenR;){if(c?c=!1:n.expect(W.comma),s&&n.afterTrailingComma(W.parenR,!0)){l=!0;break}if(n.type===W.ellipsis){a=n.start,h.push(n.parseParenItem(n.parseRestBinding())),n.type===W.comma&&n.raise(n.start,"Comma is not permitted after the rest element");break}h.push(n.parseMaybeAssign(!1,f,n.parseParenItem))}var g=this.start,x=this.startLoc;if(this.expect(W.parenR),t&&!this.canInsertSemicolon()&&this.eat(W.arrow))return this.checkPatternErrors(f,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=d,this.awaitPos=m,this.parseParenArrowList(i,r,h);h.length&&!l||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(f,!0),this.yieldPos=d||this.yieldPos,this.awaitPos=m||this.awaitPos,h.length>1?(e=this.startNodeAt(o,u),e.expressions=h,this.finishNodeAt(e,"SequenceExpression",g,x)):e=h[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var y=this.startNodeAt(i,r);return y.expression=e,this.finishNode(y,"ParenthesizedExpression")}return e},ft.parseParenItem=function(t){return t},ft.parseParenArrowList=function(t,e,n){return this.parseArrowExpression(this.startNodeAt(t,e),n)};var dt=[];ft.parseNew=function(){var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(W.dot)){t.meta=e;var n=this.containsEsc;return t.property=this.parseIdent(!0),("target"!==t.property.name||n)&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(t.start,"new.target can only be used in functions"),this.finishNode(t,"MetaProperty")}var i=this.start,r=this.startLoc;return t.callee=this.parseSubscripts(this.parseExprAtom(),i,r,!0),this.eat(W.parenL)?t.arguments=this.parseExprList(W.parenR,this.options.ecmaVersion>=8,!1):t.arguments=dt,this.finishNode(t,"NewExpression")},ft.parseTemplateElement=function(t){var e=t.isTagged,n=this.startNode();return this.type===W.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===W.backQuote,this.finishNode(n,"TemplateElement")},ft.parseTemplate=function(t){var e=this;void 0===t&&(t={});var n=t.isTagged;void 0===n&&(n=!1);var i=this.startNode();this.next(),i.expressions=[];var r=this.parseTemplateElement({isTagged:n});for(i.quasis=[r];!r.tail;)e.expect(W.dollarBraceL),i.expressions.push(e.parseExpression()),e.expect(W.braceR),i.quasis.push(r=e.parseTemplateElement({isTagged:n}));return this.next(),this.finishNode(i,"TemplateLiteral")},ft.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===W.name||this.type===W.num||this.type===W.string||this.type===W.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===W.star)&&!H.test(this.input.slice(this.lastTokEnd,this.start))},ft.parseObj=function(t,e){var n=this,i=this.startNode(),r=!0,s={};for(i.properties=[],this.next();!this.eat(W.braceR);){if(r)r=!1;else if(n.expect(W.comma),n.afterTrailingComma(W.braceR))break;var a=n.parseProperty(t,e);t||n.checkPropClash(a,s,e),i.properties.push(a)}return this.finishNode(i,t?"ObjectPattern":"ObjectExpression")},ft.parseProperty=function(t,e){var n,i,r,s,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(W.ellipsis))return t?(a.argument=this.parseIdent(!1),this.type===W.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===W.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,e),this.type===W.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(t||e)&&(r=this.start,s=this.startLoc),t||(n=this.eat(W.star)));var o=this.containsEsc;return this.parsePropertyName(a),!t&&!o&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(i=!0,n=this.options.ecmaVersion>=9&&this.eat(W.star),this.parsePropertyName(a,e)):i=!1,this.parsePropertyValue(a,t,n,i,r,s,e,o),this.finishNode(a,"Property")},ft.parsePropertyValue=function(t,e,n,i,r,s,a,o){if((n||i)&&this.type===W.colon&&this.unexpected(),this.eat(W.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===W.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(n,i);else if(e||o||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===W.comma||this.type===W.braceR)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?(this.checkUnreserved(t.key),t.kind="init",e?t.value=this.parseMaybeDefault(r,s,t.key):this.type===W.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),t.value=this.parseMaybeDefault(r,s,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(n||i)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var u="get"===t.kind?0:1;if(t.value.params.length!==u){var h=t.value.start;"get"===t.kind?this.raiseRecoverable(h,"getter should have no params"):this.raiseRecoverable(h,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},ft.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(W.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(W.bracketR),t.key;t.computed=!1}return t.key=this.type===W.num||this.type===W.string?this.parseExprAtom():this.parseIdent(!0)},ft.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=!1,t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},ft.parseMethod=function(t,e){var n=this.startNode(),i=this.inGenerator,r=this.inAsync,s=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=t),this.options.ecmaVersion>=8&&(n.async=!!e),this.inGenerator=n.generator,this.inAsync=n.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(W.parenL),n.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1),this.inGenerator=i,this.inAsync=r,this.yieldPos=s,this.awaitPos=a,this.inFunction=o,this.finishNode(n,"FunctionExpression")},ft.parseArrowExpression=function(t,e,n){var i=this.inGenerator,r=this.inAsync,s=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.enterFunctionScope(),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!n),this.inGenerator=!1,this.inAsync=t.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0),this.inGenerator=i,this.inAsync=r,this.yieldPos=s,this.awaitPos=a,this.inFunction=o,this.finishNode(t,"ArrowFunctionExpression")},ft.parseFunctionBody=function(t,e){var n=e&&this.type!==W.braceL,i=this.strict,r=!1;if(n)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var s=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);i&&!s||(r=this.strictDirective(this.end),r&&s&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var a=this.labels;this.labels=[],r&&(this.strict=!0),this.checkParams(t,!i&&!r&&!e&&this.isSimpleParamList(t.params)),t.body=this.parseBlock(!1),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=a}this.exitFunctionScope(),this.strict&&t.id&&this.checkLVal(t.id,"none"),this.strict=i},ft.isSimpleParamList=function(t){for(var e=0,n=t;e<n.length;e+=1){var i=n[e];if("Identifier"!==i.type)return!1}return!0},ft.checkParams=function(t,e){for(var n=this,i={},r=0,s=t.params;r<s.length;r+=1){var a=s[r];n.checkLVal(a,"var",e?null:i)}},ft.parseExprList=function(t,e,n,i){for(var r=this,s=[],a=!0;!this.eat(t);){if(a)a=!1;else if(r.expect(W.comma),
e&&r.afterTrailingComma(t))break;var o=void 0;n&&r.type===W.comma?o=null:r.type===W.ellipsis?(o=r.parseSpread(i),i&&r.type===W.comma&&i.trailingComma<0&&(i.trailingComma=r.start)):o=r.parseMaybeAssign(!1,i),s.push(o)}return s},ft.checkUnreserved=function(t){var e=t.start,n=t.end,i=t.name;if(this.inGenerator&&"yield"===i&&this.raiseRecoverable(e,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===i&&this.raiseRecoverable(e,"Can not use 'await' as identifier inside an async function"),this.isKeyword(i)&&this.raise(e,"Unexpected keyword '"+i+"'"),!(this.options.ecmaVersion<6&&this.input.slice(e,n).indexOf("\\")!==-1)){var r=this.strict?this.reservedWordsStrict:this.reservedWords;r.test(i)&&(this.inAsync||"await"!==i||this.raiseRecoverable(e,"Can not use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+i+"' is reserved"))}},ft.parseIdent=function(t,e){var n=this.startNode();return t&&"never"===this.options.allowReserved&&(t=!1),this.type===W.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(n,"Identifier"),t||this.checkUnreserved(n),n},ft.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===W.semi||this.canInsertSemicolon()||this.type!==W.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(W.star),t.argument=this.parseMaybeAssign()),this.finishNode(t,"YieldExpression")},ft.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0),this.finishNode(t,"AwaitExpression")};var mt=st.prototype;mt.raise=function(t,e){var n=u(this.input,t);e+=" ("+n.line+":"+n.column+")";var i=new SyntaxError(e);throw i.pos=t,i.loc=n,i.raisedAt=this.pos,i},mt.raiseRecoverable=mt.raise,mt.curPosition=function(){if(this.options.locations)return new et(this.curLine,this.pos-this.lineStart)};var gt=st.prototype,xt=Object.assign||function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var s=r[i];for(var a in s)o(s,a)&&(t[a]=s[a])}return t};gt.enterFunctionScope=function(){this.scopeStack.push({"var":{},lexical:{},childVar:{},parentLexical:{}})},gt.exitFunctionScope=function(){this.scopeStack.pop()},gt.enterLexicalScope=function(){var t=this.scopeStack[this.scopeStack.length-1],e={"var":{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(e),xt(e.parentLexical,t.lexical,t.parentLexical)},gt.exitLexicalScope=function(){var t=this.scopeStack.pop(),e=this.scopeStack[this.scopeStack.length-1];xt(e.childVar,t["var"],t.childVar)},gt.canDeclareVarName=function(t){var e=this.scopeStack[this.scopeStack.length-1];return!o(e.lexical,t)&&!o(e.parentLexical,t)},gt.canDeclareLexicalName=function(t){var e=this.scopeStack[this.scopeStack.length-1];return!o(e.lexical,t)&&!o(e["var"],t)&&!o(e.childVar,t)},gt.declareVarName=function(t){this.scopeStack[this.scopeStack.length-1]["var"][t]=!0},gt.declareLexicalName=function(t){this.scopeStack[this.scopeStack.length-1].lexical[t]=!0};var yt=function(t,e,n){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new nt(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])},vt=st.prototype;vt.startNode=function(){return new yt(this,this.start,this.startLoc)},vt.startNodeAt=function(t,e){return new yt(this,t,e)},vt.finishNode=function(t,e){return f.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},vt.finishNodeAt=function(t,e,n,i){return f.call(this,t,e,n,i)};var _t=function(t,e,n,i,r){this.token=t,this.isExpr=!!e,this.preserveSpace=!!n,this.override=i,this.generator=!!r},Et={b_stat:new _t("{",(!1)),b_expr:new _t("{",(!0)),b_tmpl:new _t("${",(!1)),p_stat:new _t("(",(!1)),p_expr:new _t("(",(!0)),q_tmpl:new _t("`",(!0),(!0),function(t){return t.tryReadTemplateToken()}),f_stat:new _t("function",(!1)),f_expr:new _t("function",(!0)),f_expr_gen:new _t("function",(!0),(!1),null,(!0)),f_gen:new _t("function",(!1),(!1),null,(!0))},Tt=st.prototype;Tt.initialContext=function(){return[Et.b_stat]},Tt.braceIsBlock=function(t){var e=this.curContext();return e===Et.f_expr||e===Et.f_stat||(t!==W.colon||e!==Et.b_stat&&e!==Et.b_expr?t===W._return||t===W.name&&this.exprAllowed?H.test(this.input.slice(this.lastTokEnd,this.start)):t===W._else||t===W.semi||t===W.eof||t===W.parenR||t===W.arrow||(t===W.braceL?e===Et.b_stat:t!==W._var&&t!==W.name&&!this.exprAllowed):!e.isExpr)},Tt.inGeneratorContext=function(){for(var t=this,e=this.context.length-1;e>=1;e--){var n=t.context[e];if("function"===n.token)return n.generator}return!1},Tt.updateContext=function(t){var e,n=this.type;n.keyword&&t===W.dot?this.exprAllowed=!1:(e=n.updateContext)?e.call(this,t):this.exprAllowed=n.beforeExpr},W.parenR.updateContext=W.braceR.updateContext=function(){if(1===this.context.length)return void(this.exprAllowed=!0);var t=this.context.pop();t===Et.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr},W.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?Et.b_stat:Et.b_expr),this.exprAllowed=!0},W.dollarBraceL.updateContext=function(){this.context.push(Et.b_tmpl),this.exprAllowed=!0},W.parenL.updateContext=function(t){var e=t===W._if||t===W._for||t===W._with||t===W._while;this.context.push(e?Et.p_stat:Et.p_expr),this.exprAllowed=!0},W.incDec.updateContext=function(){},W._function.updateContext=W._class.updateContext=function(t){t.beforeExpr&&t!==W.semi&&t!==W._else&&(t!==W.colon&&t!==W.braceL||this.curContext()!==Et.b_stat)?this.context.push(Et.f_expr):this.context.push(Et.f_stat),this.exprAllowed=!1},W.backQuote.updateContext=function(){this.curContext()===Et.q_tmpl?this.context.pop():this.context.push(Et.q_tmpl),this.exprAllowed=!1},W.star.updateContext=function(t){if(t===W._function){var e=this.context.length-1;this.context[e]===Et.f_expr?this.context[e]=Et.f_expr_gen:this.context[e]=Et.f_gen}this.exprAllowed=!0},W.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var bt={$LONE:["ASCII","ASCII_Hex_Digit","AHex","Alphabetic","Alpha","Any","Assigned","Bidi_Control","Bidi_C","Bidi_Mirrored","Bidi_M","Case_Ignorable","CI","Cased","Changes_When_Casefolded","CWCF","Changes_When_Casemapped","CWCM","Changes_When_Lowercased","CWL","Changes_When_NFKC_Casefolded","CWKCF","Changes_When_Titlecased","CWT","Changes_When_Uppercased","CWU","Dash","Default_Ignorable_Code_Point","DI","Deprecated","Dep","Diacritic","Dia","Emoji","Emoji_Component","Emoji_Modifier","Emoji_Modifier_Base","Emoji_Presentation","Extender","Ext","Grapheme_Base","Gr_Base","Grapheme_Extend","Gr_Ext","Hex_Digit","Hex","IDS_Binary_Operator","IDSB","IDS_Trinary_Operator","IDST","ID_Continue","IDC","ID_Start","IDS","Ideographic","Ideo","Join_Control","Join_C","Logical_Order_Exception","LOE","Lowercase","Lower","Math","Noncharacter_Code_Point","NChar","Pattern_Syntax","Pat_Syn","Pattern_White_Space","Pat_WS","Quotation_Mark","QMark","Radical","Regional_Indicator","RI","Sentence_Terminal","STerm","Soft_Dotted","SD","Terminal_Punctuation","Term","Unified_Ideograph","UIdeo","Uppercase","Upper","Variation_Selector","VS","White_Space","space","XID_Continue","XIDC","XID_Start","XIDS"],General_Category:["Cased_Letter","LC","Close_Punctuation","Pe","Connector_Punctuation","Pc","Control","Cc","cntrl","Currency_Symbol","Sc","Dash_Punctuation","Pd","Decimal_Number","Nd","digit","Enclosing_Mark","Me","Final_Punctuation","Pf","Format","Cf","Initial_Punctuation","Pi","Letter","L","Letter_Number","Nl","Line_Separator","Zl","Lowercase_Letter","Ll","Mark","M","Combining_Mark","Math_Symbol","Sm","Modifier_Letter","Lm","Modifier_Symbol","Sk","Nonspacing_Mark","Mn","Number","N","Open_Punctuation","Ps","Other","C","Other_Letter","Lo","Other_Number","No","Other_Punctuation","Po","Other_Symbol","So","Paragraph_Separator","Zp","Private_Use","Co","Punctuation","P","punct","Separator","Z","Space_Separator","Zs","Spacing_Mark","Mc","Surrogate","Cs","Symbol","S","Titlecase_Letter","Lt","Unassigned","Cn","Uppercase_Letter","Lu"],Script:["Adlam","Adlm","Ahom","Anatolian_Hieroglyphs","Hluw","Arabic","Arab","Armenian","Armn","Avestan","Avst","Balinese","Bali","Bamum","Bamu","Bassa_Vah","Bass","Batak","Batk","Bengali","Beng","Bhaiksuki","Bhks","Bopomofo","Bopo","Brahmi","Brah","Braille","Brai","Buginese","Bugi","Buhid","Buhd","Canadian_Aboriginal","Cans","Carian","Cari","Caucasian_Albanian","Aghb","Chakma","Cakm","Cham","Cherokee","Cher","Common","Zyyy","Coptic","Copt","Qaac","Cuneiform","Xsux","Cypriot","Cprt","Cyrillic","Cyrl","Deseret","Dsrt","Devanagari","Deva","Duployan","Dupl","Egyptian_Hieroglyphs","Egyp","Elbasan","Elba","Ethiopic","Ethi","Georgian","Geor","Glagolitic","Glag","Gothic","Goth","Grantha","Gran","Greek","Grek","Gujarati","Gujr","Gurmukhi","Guru","Han","Hani","Hangul","Hang","Hanunoo","Hano","Hatran","Hatr","Hebrew","Hebr","Hiragana","Hira","Imperial_Aramaic","Armi","Inherited","Zinh","Qaai","Inscriptional_Pahlavi","Phli","Inscriptional_Parthian","Prti","Javanese","Java","Kaithi","Kthi","Kannada","Knda","Katakana","Kana","Kayah_Li","Kali","Kharoshthi","Khar","Khmer","Khmr","Khojki","Khoj","Khudawadi","Sind","Lao","Laoo","Latin","Latn","Lepcha","Lepc","Limbu","Limb","Linear_A","Lina","Linear_B","Linb","Lisu","Lycian","Lyci","Lydian","Lydi","Mahajani","Mahj","Malayalam","Mlym","Mandaic","Mand","Manichaean","Mani","Marchen","Marc","Masaram_Gondi","Gonm","Meetei_Mayek","Mtei","Mende_Kikakui","Mend","Meroitic_Cursive","Merc","Meroitic_Hieroglyphs","Mero","Miao","Plrd","Modi","Mongolian","Mong","Mro","Mroo","Multani","Mult","Myanmar","Mymr","Nabataean","Nbat","New_Tai_Lue","Talu","Newa","Nko","Nkoo","Nushu","Nshu","Ogham","Ogam","Ol_Chiki","Olck","Old_Hungarian","Hung","Old_Italic","Ital","Old_North_Arabian","Narb","Old_Permic","Perm","Old_Persian","Xpeo","Old_South_Arabian","Sarb","Old_Turkic","Orkh","Oriya","Orya","Osage","Osge","Osmanya","Osma","Pahawh_Hmong","Hmng","Palmyrene","Palm","Pau_Cin_Hau","Pauc","Phags_Pa","Phag","Phoenician","Phnx","Psalter_Pahlavi","Phlp","Rejang","Rjng","Runic","Runr","Samaritan","Samr","Saurashtra","Saur","Sharada","Shrd","Shavian","Shaw","Siddham","Sidd","SignWriting","Sgnw","Sinhala","Sinh","Sora_Sompeng","Sora","Soyombo","Soyo","Sundanese","Sund","Syloti_Nagri","Sylo","Syriac","Syrc","Tagalog","Tglg","Tagbanwa","Tagb","Tai_Le","Tale","Tai_Tham","Lana","Tai_Viet","Tavt","Takri","Takr","Tamil","Taml","Tangut","Tang","Telugu","Telu","Thaana","Thaa","Thai","Tibetan","Tibt","Tifinagh","Tfng","Tirhuta","Tirh","Ugaritic","Ugar","Vai","Vaii","Warang_Citi","Wara","Yi","Yiii","Zanabazar_Square","Zanb"]};Array.prototype.push.apply(bt.$LONE,bt.General_Category),bt.gc=bt.General_Category,bt.sc=bt.Script_Extensions=bt.scx=bt.Script;var St=st.prototype,kt=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};kt.prototype.reset=function(t,e,n){var i=n.indexOf("u")!==-1;this.start=0|t,this.source=e+"",this.flags=n,this.switchU=i&&this.parser.options.ecmaVersion>=6,this.switchN=i&&this.parser.options.ecmaVersion>=9},kt.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},kt.prototype.at=function(t){var e=this.source,n=e.length;if(t>=n)return-1;var i=e.charCodeAt(t);return!this.switchU||i<=55295||i>=57344||t+1>=n?i:(i<<10)+e.charCodeAt(t+1)-56613888},kt.prototype.nextIndex=function(t){var e=this.source,n=e.length;if(t>=n)return n;var i=e.charCodeAt(t);return!this.switchU||i<=55295||i>=57344||t+1>=n?t+1:t+2},kt.prototype.current=function(){return this.at(this.pos)},kt.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},kt.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},kt.prototype.eat=function(t){return this.current()===t&&(this.advance(),!0)},St.validateRegExpFlags=function(t){for(var e=this,n=t.validFlags,i=t.flags,r=0;r<i.length;r++){var s=i.charAt(r);n.indexOf(s)===-1&&e.raise(t.start,"Invalid regular expression flag"),i.indexOf(s,r+1)>-1&&e.raise(t.start,"Duplicate regular expression flag")}},St.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},St.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,n=t.backReferenceNames;e<n.length;e+=1){var i=n[e];t.groupNames.indexOf(i)===-1&&t.raise("Invalid named capture referenced")}},St.regexp_disjunction=function(t){var e=this;for(this.regexp_alternative(t);t.eat(124);)e.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},St.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},St.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!(t.switchU?!this.regexp_eatAtom(t):!this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},St.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!n,!0}return t.pos=e,!1},St.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},St.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},St.regexp_eatBracedQuantifier=function(t,e){var n=t.pos;if(t.eat(123)){var i=0,r=-1;if(this.regexp_eatDecimalDigits(t)&&(i=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue),t.eat(125)))return r!==-1&&r<i&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=n}return!1},St.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},St.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},St.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},St.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},St.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},St.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},St.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!m(e)&&(t.lastIntValue=e,t.advance(),!0)},St.regexp_eatPatternCharacters=function(t){for(var e=t.pos,n=0;(n=t.current())!==-1&&!m(n);)t.advance();return t.pos!==e},St.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(e===-1||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e)&&(t.advance(),!0)},St.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return t.groupNames.indexOf(t.lastStringValue)!==-1&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},St.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},St.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=d(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=d(t.lastIntValue);return!0}return!1},St.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,n=t.current();return t.advance(),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(n=t.lastIntValue),g(n)?(t.lastIntValue=n,!0):(t.pos=e,!1)},St.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,n=t.current();return t.advance(),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(n=t.lastIntValue),x(n)?(t.lastIntValue=n,!0):(t.pos=e,!1)},St.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},St.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var n=t.lastIntValue;if(t.switchU)return n>t.maxBackReference&&(t.maxBackReference=n),!0;if(n<=t.numCapturingParens)return!0;t.pos=e}return!1},St.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},St.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},St.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},St.regexp_eatZero=function(t){return 48===t.current()&&!b(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},St.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},St.regexp_eatControlLetter=function(t){var e=t.current();return!!y(e)&&(t.lastIntValue=e%32,t.advance(),!0)},St.regexp_eatRegExpUnicodeEscapeSequence=function(t){var e=t.pos;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var n=t.lastIntValue;if(t.switchU&&n>=55296&&n<=56319){var i=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var r=t.lastIntValue;if(r>=56320&&r<=57343)return t.lastIntValue=1024*(n-55296)+(r-56320)+65536,!0}t.pos=i,t.lastIntValue=n}return!0}if(t.switchU&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&v(t.lastIntValue))return!0;t.switchU&&t.raise("Invalid unicode escape"),t.pos=e}return!1},St.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e)&&(t.lastIntValue=e,t.advance(),!0)},St.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do t.lastIntValue=10*t.lastIntValue+(e-48),t.advance();while((e=t.current())>=48&&e<=57);return!0}return!1},St.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(_(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},St.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var n=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var i=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,n,i),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,r),!0}return!1},St.regexp_validateUnicodePropertyNameAndValue=function(t,e,n){bt.hasOwnProperty(e)&&bt[e].indexOf(n)!==-1||t.raise("Invalid property name")},St.regexp_validateUnicodePropertyNameOrValue=function(t,e){bt.$LONE.indexOf(e)===-1&&t.raise("Invalid property name")},St.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";E(e=t.current());)t.lastStringValue+=d(e),t.advance();return""!==t.lastStringValue},St.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";T(e=t.current());)t.lastStringValue+=d(e),t.advance();return""!==t.lastStringValue},St.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},St.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},St.regexp_classRanges=function(t){for(var e=this;this.regexp_eatClassAtom(t);){var n=t.lastIntValue;if(t.eat(45)&&e.regexp_eatClassAtom(t)){var i=t.lastIntValue;!t.switchU||n!==-1&&i!==-1||t.raise("Invalid character class"),n!==-1&&i!==-1&&n>i&&t.raise("Range out of order in character class")}}},St.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var n=t.current();(99===n||A(n))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var i=t.current();return 93!==i&&(t.lastIntValue=i,t.advance(),!0)},St.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},St.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!b(e)&&95!==e)&&(t.lastIntValue=e%32,t.advance(),!0)},St.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},St.regexp_eatDecimalDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;b(n=t.current());)t.lastIntValue=10*t.lastIntValue+(n-48),t.advance();return t.pos!==e},St.regexp_eatHexDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;S(n=t.current());)t.lastIntValue=16*t.lastIntValue+k(n),t.advance();return t.pos!==e},St.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var n=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*n+t.lastIntValue:t.lastIntValue=8*e+n}else t.lastIntValue=e;return!0}return!1},St.regexp_eatOctalDigit=function(t){var e=t.current();return A(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},St.regexp_eatFixedHexDigits=function(t,e){var n=t.pos;t.lastIntValue=0;for(var i=0;i<e;++i){var r=t.current();if(!S(r))return t.pos=n,!1;t.lastIntValue=16*t.lastIntValue+k(r),t.advance()}return!0};var At=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new nt(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},Rt=st.prototype;Rt.next=function(){this.options.onToken&&this.options.onToken(new At(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Rt.getToken=function(){return this.next(),new At(this)},"undefined"!=typeof Symbol&&(Rt[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===W.eof,value:e}}}}),Rt.curContext=function(){return this.context[this.context.length-1]},Rt.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(W.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},Rt.readToken=function(t){return n(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},Rt.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);if(t<=55295||t>=57344)return t;var e=this.input.charCodeAt(this.pos+1);return(t<<10)+e-56613888},Rt.skipBlockComment=function(){var t=this,e=this.options.onComment&&this.curPosition(),n=this.pos,i=this.input.indexOf("*/",this.pos+=2);if(i===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=i+2,this.options.locations){Y.lastIndex=n;for(var r;(r=Y.exec(this.input))&&r.index<this.pos;)++t.curLine,t.lineStart=r.index+r[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,i),n,this.pos,e,this.curPosition())},Rt.skipLineComment=function(t){for(var e=this,n=this.pos,i=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!a(r);)r=e.input.charCodeAt(++e.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(n+t,this.pos),n,this.pos,i,this.curPosition())},Rt.skipSpace=function(){var t=this;t:for(;this.pos<this.input.length;){var e=t.input.charCodeAt(t.pos);switch(e){case 32:case 160:++t.pos;break;case 13:10===t.input.charCodeAt(t.pos+1)&&++t.pos;case 10:case 8232:case 8233:++t.pos,t.options.locations&&(++t.curLine,t.lineStart=t.pos);break;case 47:switch(t.input.charCodeAt(t.pos+1)){case 42:t.skipBlockComment();break;case 47:t.skipLineComment(2);break;default:break t}break;default:if(!(e>8&&e<14||e>=5760&&q.test(String.fromCharCode(e))))break t;++t.pos}}},Rt.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=t,this.value=e,this.updateContext(n)},Rt.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(W.ellipsis)):(++this.pos,this.finishToken(W.dot))},Rt.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(W.assign,2):this.finishOp(W.slash,1)},Rt.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),n=1,i=42===t?W.star:W.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++n,i=W.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(W.assign,n+1):this.finishOp(i,n)},Rt.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?this.finishOp(124===t?W.logicalOR:W.logicalAND,2):61===e?this.finishOp(W.assign,2):this.finishOp(124===t?W.bitwiseOR:W.bitwiseAND,1)},Rt.readToken_caret=function(){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(W.assign,2):this.finishOp(W.bitwiseXOR,1)},Rt.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!H.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(W.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(W.assign,2):this.finishOp(W.plusMin,1)},Rt.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),n=1;return e===t?(n=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(W.assign,n+1):this.finishOp(W.bitShift,n)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(n=2),this.finishOp(W.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},Rt.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(W.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(W.arrow)):this.finishOp(61===t?W.eq:W.prefix,1)},Rt.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(W.parenL);case 41:return++this.pos,this.finishToken(W.parenR);case 59:return++this.pos,this.finishToken(W.semi);case 44:return++this.pos,this.finishToken(W.comma);case 91:return++this.pos,this.finishToken(W.bracketL);case 93:return++this.pos,this.finishToken(W.bracketR);case 123:return++this.pos,this.finishToken(W.braceL);case 125:return++this.pos,this.finishToken(W.braceR);case 58:return++this.pos,this.finishToken(W.colon);case 63:return++this.pos,this.finishToken(W.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(W.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 126:return this.finishOp(W.prefix,1)}this.raise(this.pos,"Unexpected character '"+R(t)+"'")},Rt.finishOp=function(t,e){var n=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,n)},Rt.readRegexp=function(){for(var t,e,n=this,i=this.pos;;){n.pos>=n.input.length&&n.raise(i,"Unterminated regular expression");var r=n.input.charAt(n.pos);if(H.test(r)&&n.raise(i,"Unterminated regular expression"),t)t=!1;else{if("["===r)e=!0;else if("]"===r&&e)e=!1;else if("/"===r&&!e)break;t="\\"===r}++n.pos}var s=this.input.slice(i,this.pos);++this.pos;var a=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(a);var u=this.regexpState||(this.regexpState=new kt(this));u.reset(i,s,o),this.validateRegExpFlags(u),this.validateRegExpPattern(u);var h=null;try{h=new RegExp(s,o)}catch(c){}return this.finishToken(W.regexp,{pattern:s,flags:o,value:h})},Rt.readInt=function(t,e){for(var n=this,i=this.pos,r=0,s=0,a=null==e?1/0:e;s<a;++s){var o=n.input.charCodeAt(n.pos),u=void 0;if(u=o>=97?o-97+10:o>=65?o-65+10:o>=48&&o<=57?o-48:1/0,u>=t)break;++n.pos,r=r*t+u}return this.pos===i||null!=e&&this.pos-i!==e?null:r},Rt.readRadixNumber=function(t){this.pos+=2;var e=this.readInt(t);return null==e&&this.raise(this.start+2,"Expected number in radix "+t),n(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(W.num,e)},Rt.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10)||this.raise(e,"Invalid number");var i=this.pos-e>=2&&48===this.input.charCodeAt(e);i&&this.strict&&this.raise(e,"Invalid number"),
i&&/[89]/.test(this.input.slice(e,this.pos))&&(i=!1);var r=this.input.charCodeAt(this.pos);46!==r||i||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||i||(r=this.input.charCodeAt(++this.pos),43!==r&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),n(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var s=this.input.slice(e,this.pos),a=i?parseInt(s,8):parseFloat(s);return this.finishToken(W.num,a)},Rt.readCodePoint=function(){var t,e=this.input.charCodeAt(this.pos);if(123===e){this.options.ecmaVersion<6&&this.unexpected();var n=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(n,"Code point out of bounds")}else t=this.readHexChar(4);return t},Rt.readString=function(t){for(var e=this,n="",i=++this.pos;;){e.pos>=e.input.length&&e.raise(e.start,"Unterminated string constant");var r=e.input.charCodeAt(e.pos);if(r===t)break;92===r?(n+=e.input.slice(i,e.pos),n+=e.readEscapedChar(!1),i=e.pos):(a(r,e.options.ecmaVersion>=10)&&e.raise(e.start,"Unterminated string constant"),++e.pos)}return n+=this.input.slice(i,this.pos++),this.finishToken(W.string,n)};var wt={};Rt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==wt)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},Rt.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw wt;this.raise(t,e)},Rt.readTmplToken=function(){for(var t=this,e="",n=this.pos;;){t.pos>=t.input.length&&t.raise(t.start,"Unterminated template");var i=t.input.charCodeAt(t.pos);if(96===i||36===i&&123===t.input.charCodeAt(t.pos+1))return t.pos!==t.start||t.type!==W.template&&t.type!==W.invalidTemplate?(e+=t.input.slice(n,t.pos),t.finishToken(W.template,e)):36===i?(t.pos+=2,t.finishToken(W.dollarBraceL)):(++t.pos,t.finishToken(W.backQuote));if(92===i)e+=t.input.slice(n,t.pos),e+=t.readEscapedChar(!0),n=t.pos;else if(a(i)){switch(e+=t.input.slice(n,t.pos),++t.pos,i){case 13:10===t.input.charCodeAt(t.pos)&&++t.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(i)}t.options.locations&&(++t.curLine,t.lineStart=t.pos),n=t.pos}else++t.pos}},Rt.readInvalidTemplateToken=function(){for(var t=this;this.pos<this.input.length;this.pos++)switch(t.input[t.pos]){case"\\":++t.pos;break;case"$":if("{"!==t.input[t.pos+1])break;case"`":return t.finishToken(W.invalidTemplate,t.input.slice(t.start,t.pos))}this.raise(this.start,"Unterminated template")},Rt.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return R(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\x0B";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(e>=48&&e<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(n,8);return i>255&&(n=n.slice(0,-1),i=parseInt(n,8)),this.pos+=n.length-1,e=this.input.charCodeAt(this.pos),"0"===n&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-n.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return String.fromCharCode(e)}},Rt.readHexChar=function(t){var e=this.pos,n=this.readInt(16,t);return null===n&&this.invalidStringToken(e,"Bad character escape sequence"),n},Rt.readWord1=function(){var t=this;this.containsEsc=!1;for(var e="",r=!0,s=this.pos,a=this.options.ecmaVersion>=6;this.pos<this.input.length;){var o=t.fullCharCodeAtPos();if(i(o,a))t.pos+=o<=65535?1:2;else{if(92!==o)break;t.containsEsc=!0,e+=t.input.slice(s,t.pos);var u=t.pos;117!==t.input.charCodeAt(++t.pos)&&t.invalidStringToken(t.pos,"Expecting Unicode escape sequence \\uXXXX"),++t.pos;var h=t.readCodePoint();(r?n:i)(h,a)||t.invalidStringToken(u,"Invalid Unicode escape"),e+=R(h),s=t.pos}r=!1}return e+this.input.slice(s,this.pos)},Rt.readWord=function(){var t=this.readWord1(),e=W.name;return this.keywords.test(t)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+t),e=K[t]),this.finishToken(e,t)};var Ct="5.7.1";t.version=Ct,t.parse=w,t.parseExpressionAt=C,t.tokenizer=I,t.addLooseExports=D,t.Parser=st,t.plugins=rt,t.defaultOptions=it,t.Position=et,t.SourceLocation=nt,t.getLineInfo=u,t.Node=yt,t.TokenType=j,t.tokTypes=W,t.keywordTypes=K,t.TokContext=_t,t.tokContexts=Et,t.isIdentifierChar=i,t.isIdentifierStart=n,t.Token=At,t.isNewLine=a,t.lineBreak=H,t.lineBreakG=Y,t.nonASCIIwhitespace=q,Object.defineProperty(t,"__esModule",{value:!0})})},{}],26:[function(t,e,n){},{}]},{},[20]);